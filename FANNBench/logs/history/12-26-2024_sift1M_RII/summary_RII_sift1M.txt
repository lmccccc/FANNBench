Start time: 08:13
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,196
find_nn+update_center_time,448
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,227
find_nn+update_center_time,481
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,178
find_nn+update_center_time,449
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,227
find_nn+update_center_time,491
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,180
find_nn+update_center_time,180
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1152, 4096, 8192, 16384, 128]
polyfit coeff: [-7.03655914e-02  6.42666667e+03]
resultant func:  
-0.07037 x + 6427
train time:  59.6728994846344  add time:  65.1176085472107  construction time:  124.79050803184509
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random construction 1"
	User time (seconds): 2376.93
	System time (seconds): 7.25
	Percent of CPU this job got: 1877%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:06.97
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1299404
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 346444
	Voluntary context switches: 8878
	Involuntary context switches: 25350
	Swaps: 0
	File system inputs: 0
	File system outputs: 261184
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 09:44
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,189
find_nn+update_center_time,441
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,181
find_nn+update_center_time,403
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,181
find_nn+update_center_time,406
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,220
find_nn+update_center_time,449
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,188
find_nn+update_center_time,188
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [2048, 4096, 8192, 16384, 128]
polyfit coeff: [-1.01677419e-01  6.80000000e+03]
resultant func:  
-0.1017 x + 6800
train time:  63.14096808433533  add time:  63.41138744354248  construction time:  126.55235552787781
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random construction 1"
	User time (seconds): 2357.99
	System time (seconds): 6.99
	Percent of CPU this job got: 1837%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:08.71
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1300068
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 345302
	Voluntary context switches: 9620
	Involuntary context switches: 25515
	Swaps: 0
	File system inputs: 0
	File system outputs: 261192
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 11:16
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,216
find_nn+update_center_time,430
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,184
find_nn+update_center_time,408
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,190
find_nn+update_center_time,420
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,181
find_nn+update_center_time,419
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,212
find_nn+update_center_time,212
Start to update posting lists
===== Threshold selection ====
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1216, 4096, 8192, 16384, 65536]
polyfit coeff: [ 4.23518280e+00 -7.17333333e+03]
resultant func:  
4.235 x - 7173
train time:  58.689194440841675  add time:  71.39603185653687  construction time:  130.08522629737854
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random construction 1"
	User time (seconds): 2821.00
	System time (seconds): 7.13
	Percent of CPU this job got: 2138%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:12.23
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1298128
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 374116
	Voluntary context switches: 11558
	Involuntary context switches: 29876
	Swaps: 0
	File system inputs: 0
	File system outputs: 261200
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 12:47
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,190
find_nn+update_center_time,410
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,230
find_nn+update_center_time,457
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,222
find_nn+update_center_time,452
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,179
find_nn+update_center_time,414
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,223
find_nn+update_center_time,223
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1152, 4096, 8192, 128, 47104]
polyfit coeff: [ 2.82683871e+00 -5.39200000e+03]
resultant func:  
2.827 x - 5392
train time:  59.41393733024597  add time:  65.51844549179077  construction time:  124.93238282203674
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random construction 1"
	User time (seconds): 2367.26
	System time (seconds): 7.23
	Percent of CPU this job got: 1868%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:07.05
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1300400
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 345770
	Voluntary context switches: 9275
	Involuntary context switches: 25130
	Swaps: 0
	File system inputs: 0
	File system outputs: 261192
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
