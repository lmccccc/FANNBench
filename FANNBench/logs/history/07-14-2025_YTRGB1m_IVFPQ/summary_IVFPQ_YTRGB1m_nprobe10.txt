Start time: 03:23
====================
START: running IVFPQ_INDEX_CONSTRUCTION, sift data --

dataset: YTRGB1m
N: 1000000
topk: 10
threads: 128
dataset file: /mnt/data/mocheng/dataset/youtube1m/rgb.fvecs
attr file: /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
index file: /mnt/data/mocheng/dataset/youtube1m/ivfpq/index/index_ivfpq_sel_2_100000_random_1024
dim: 1024
partition_size: 1024
train file: /mnt/data/mocheng/dataset/youtube1m/rgb_train.fvecs
loaded base attributes, size:1000000
[ 0.072s ] Loaded attributions, 1000000 found
[ 0.072s ] Index Params -- d: 1024, N: 1000000
ncentroids: 4000
====================Vectors====================

[ 0.073s ] Loading database
[ 2.471s ] Loaded base vectors from file: /mnt/data/mocheng/dataset/youtube1m/rgb.fvecs
data loaded, with dim: 1024, N=1000000
[ 2.471s ] Indexing database, size 1000000*1024 from max 1000000
[ 2.471s ] Adding the vectors to the index
WARNING clustering 62041 points to 4000 centroids: please provide at least 156000 training points
train cost:0.574
index construction total cost:4483.439
[ 4483.439s ] Vectors added to  index
Index vectors added:1000000
====================Write Index================

[ 4486.743s ] Wrote ivbfpq index to file: /mnt/data/mocheng/dataset/youtube1m/ivfpq/index/index_ivfpq_sel_2_100000_random_1024
[4486.743 s] -----DONE-----
[ 4486.743s ] -----DONE-----
	Command being timed: "../faiss/build/demos/ivfpq_build YTRGB1m 1000000 10 128 /mnt/data/mocheng/dataset/youtube1m/rgb.fvecs /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/attr_sel_2_100000_random.json /mnt/data/mocheng/dataset/youtube1m/ivfpq/index/index_ivfpq_sel_2_100000_random_1024 1024 1024 /mnt/data/mocheng/dataset/youtube1m/rgb_train.fvecs"
	User time (seconds): 505720.14
	System time (seconds): 122.08
	Percent of CPU this job got: 11273%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 1:14:46
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 5648528
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 1
	Minor (reclaiming a frame) page faults: 10541900
	Voluntary context switches: 9881521
	Involuntary context switches: 29894940
	Swaps: 0
	File system inputs: 497840
	File system outputs: 2049752
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 05:21
====================
START: running TEST_IVFPQ, sift data --

dataset: YTRGB1m
N: 1000000
topk: 10
threads: 1
dataset file: /mnt/data/mocheng/dataset/youtube1m/rgb.fvecs
query file: /mnt/data/mocheng/dataset/youtube1m/rgb_query.fvecs
attr file: /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
qrange file: /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/qrangesel_6_2_100000_random_6.json
gt file: /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/sif_gt_sel_6_2_100000_random_6_10.json
index file: /mnt/data/mocheng/dataset/youtube1m/ivfpq/index/index_ivfpq_sel_2_100000_random_1024
nprobe: 10
dim: 1024
loaded base attributes from:/mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
[ 0.256s ] Loaded metadata, 2000000 attr's found
[ 0.256s ] Loading query vectors and attributes
query vecs data loaded, with dim: 1024, nb=10000
[ 0.288s ] Loaded query vectors from /mnt/data/mocheng/dataset/youtube1m/rgb_query.fvecs
[ 0.293s ] Loaded 10000 YTRGB1m queries
[ 0.307s ] Loaded ground truth, gt_size: 10
[ 0.307s ] Index Params -- d: 1024, N: 1000000
 load index size: 1000000
--Index created
==============================================
====================Search Results====================
==============================================
==============================================
====================Search====================
==============================================
==================== IVFPQ INDEX ====================
[ 1.285s ] Searching the 10 nearest neighbors of 10000 vectors in the index
selectivity: 0.500
[ 363.390s ] Query results (vector ids, then distances):
query 0 nn's (6, 10418, 93742): 889953 (68213) 333483 (49490) 521249 (14113) 418474 (6) 662806 (6) 467816 (6) 239994 (6) 694505 (89822) 809944 (6) 86717 (55411) 
     dis: 	83.516 86.873 88.147 88.692 88.695 89.513 90.033 90.728 91.388 92.091 
query 1 nn's (6, 871, 84222): 963956 (19) 506689 (83207) 630027 (60046) 326679 (4165) 172456 (6) 627139 (56170) 689633 (43777) 867145 (68811) 380703 (15922) 546210 (6) 
     dis: 	53.152 53.410 53.657 54.385 54.616 54.616 54.666 55.627 55.658 56.392 
query 2 nn's (6, 2953, 86302): 423205 (46713) 871743 (85658) 947479 (343) 633590 (10) 308085 (55976) 528201 (60263) 529153 (96313) 509845 (63335) 666817 (61632) 979613 (81292) 
     dis: 	132.549 136.082 137.181 137.406 137.751 137.994 138.967 139.102 139.333 139.433 
query 3 nn's (6, 1285, 84611): 462979 (51579) 421752 (10) 505074 (20) 870912 (19) 26879 (16840) 99295 (13036) 873503 (85666) 62225 (27952) 469561 (29678) 376313 (57309) 
     dis: 	141.945 145.214 147.416 153.019 159.994 167.020 167.142 168.651 170.421 170.594 
query 4 nn's (6, 13289, 96651): 314093 (51859) 719380 (6) 690285 (95271) 223865 (30084) 461345 (34528) 89809 (62375) 829463 (43989) 62933 (58365) 135316 (6) 33136 (6) 
     dis: 	52.786 56.196 63.005 65.580 71.458 72.469 74.054 75.221 75.255 75.782 
[ 363.390s ] *** Query time: 308.258
qps: 32.440
 *** ivfpq recall 
ivfpq get 89067 postive res from 100000 results, recall@10:0.891
recall dist(10% per bucket): 0.000 0.001 0.002 0.005 0.010 0.021 0.041 0.077 0.121 0.234 0.489 
finished ivfpq index examples
[ 363.390s ] -----DONE-----
	Command being timed: "../faiss/build/demos/ivfpq_query_arbi YTRGB1m 1000000 10 1 /mnt/data/mocheng/dataset/youtube1m/rgb.fvecs /mnt/data/mocheng/dataset/youtube1m/rgb_query.fvecs /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/attr_sel_2_100000_random.json /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/qrangesel_6_2_100000_random_6.json /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/sif_gt_sel_6_2_100000_random_6_10.json /mnt/data/mocheng/dataset/youtube1m/ivfpq/index/index_ivfpq_sel_2_100000_random_1024 10 1024"
	User time (seconds): 362.08
	System time (seconds): 1.38
	Percent of CPU this job got: 99%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 6:03.49
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1090468
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 308791
	Voluntary context switches: 1
	Involuntary context switches: 614
	Swaps: 0
	File system inputs: 0
	File system outputs: 16
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 07:52
====================
START: running TEST_IVFPQ, sift data --

dataset: YTRGB1m
N: 1000000
topk: 10
threads: 1
dataset file: /mnt/data/mocheng/dataset/youtube1m/rgb.fvecs
query file: /mnt/data/mocheng/dataset/youtube1m/rgb_query.fvecs
attr file: /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
qrange file: /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/qrangesel_10_2_100000_random_10.json
gt file: /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/sif_gt_sel_10_2_100000_random_10_10.json
index file: /mnt/data/mocheng/dataset/youtube1m/ivfpq/index/index_ivfpq_sel_2_100000_random_1024
nprobe: 10
dim: 1024
loaded base attributes from:/mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
[ 0.133s ] Loaded metadata, 2000000 attr's found
[ 0.133s ] Loading query vectors and attributes
query vecs data loaded, with dim: 1024, nb=10000
[ 0.157s ] Loaded query vectors from /mnt/data/mocheng/dataset/youtube1m/rgb_query.fvecs
[ 0.159s ] Loaded 10000 YTRGB1m queries
[ 0.167s ] Loaded ground truth, gt_size: 10
[ 0.167s ] Index Params -- d: 1024, N: 1000000
 load index size: 1000000
--Index created
==============================================
====================Search Results====================
==============================================
==============================================
====================Search====================
==============================================
==================== IVFPQ INDEX ====================
[ 0.919s ] Searching the 10 nearest neighbors of 10000 vectors in the index
selectivity: 0.100
[ 178.274s ] Query results (vector ids, then distances):
query 0 nn's (10, 29652, 63053): 980214 (6) 952701 (65239) 336603 (41586) 16765 (90599) 991479 (76766) 863882 (6) 202136 (20) 76521 (96391) 283397 (4891) 38338 (6) 
     dis: 	88.558 93.345 94.030 94.103 95.997 96.198 96.274 96.676 96.720 96.858 
query 1 nn's (10, 21798, 55183): 358433 (13457) 411735 (53826) 762596 (6) 653907 (70875) 753176 (10) 485054 (6) 295338 (20) 908662 (10) 821906 (6) 578863 (50735) 
     dis: 	54.557 55.073 57.300 59.085 59.367 59.387 59.486 60.146 60.200 60.917 
query 2 nn's (10, 52376, 85679): 225875 (13229) 464997 (41748) 698610 (6) 677717 (22673) 67581 (54414) 907166 (10) 812421 (30697) 39208 (10) 189077 (61917) 308623 (70098) 
     dis: 	136.548 139.450 140.792 140.878 142.192 142.652 142.720 143.307 143.495 143.934 
query 3 nn's (10, 54432, 87740): 263195 (52685) 178166 (6) 136177 (10503) 117658 (10) 159269 (1572) 960065 (21061) 373736 (6) 496154 (6) 195003 (84381) 242590 (6) 
     dis: 	178.014 180.412 181.342 184.246 184.687 186.296 186.831 187.131 187.153 187.452 
query 4 nn's (10, 16884, 50269): 729225 (73615) 725265 (93655) 565522 (10) 693282 (10) 203716 (10) 561793 (81060) 258251 (47005) 86342 (6) 88323 (53150) 652567 (22431) 
     dis: 	74.408 78.044 79.706 79.910 93.073 94.450 96.538 99.218 101.477 101.703 
[ 178.274s ] *** Query time: 129.955
qps: 76.950
 *** ivfpq recall 
ivfpq get 83715 postive res from 100000 results, recall@10:0.837
recall dist(10% per bucket): 0.001 0.002 0.006 0.011 0.025 0.040 0.069 0.099 0.163 0.231 0.354 
finished ivfpq index examples
[ 178.275s ] -----DONE-----
	Command being timed: "../faiss/build/demos/ivfpq_query_arbi YTRGB1m 1000000 10 1 /mnt/data/mocheng/dataset/youtube1m/rgb.fvecs /mnt/data/mocheng/dataset/youtube1m/rgb_query.fvecs /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/attr_sel_2_100000_random.json /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/qrangesel_10_2_100000_random_10.json /mnt/data/mocheng/dataset/youtube1m/label/sel_2_100000_random/sif_gt_sel_10_2_100000_random_10_10.json /mnt/data/mocheng/dataset/youtube1m/ivfpq/index/index_ivfpq_sel_2_100000_random_1024 10 1024"
	User time (seconds): 177.36
	System time (seconds): 0.97
	Percent of CPU this job got: 99%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:58.34
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1090472
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 272322
	Voluntary context switches: 1
	Involuntary context switches: 247
	Swaps: 0
	File system inputs: 0
	File system outputs: 16
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
