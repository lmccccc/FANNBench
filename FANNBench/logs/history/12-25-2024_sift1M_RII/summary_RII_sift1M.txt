Start time: 09:02
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,188
find_nn+update_center_time,442
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,193
find_nn+update_center_time,412
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,210
find_nn+update_center_time,440
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,180
find_nn+update_center_time,407
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,222
find_nn+update_center_time,222
Start to update posting lists
===== Threshold selection ====
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1152, 4096, 8192, 16384, 65536]
polyfit coeff: [ 4.23741935e+00 -7.20000000e+03]
resultant func:  
4.237 x - 7200
train time:  60.38477396965027  add time:  71.88965392112732  construction time:  132.2744278907776
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random construction 1"
	User time (seconds): 2872.52
	System time (seconds): 7.77
	Percent of CPU this job got: 2117%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:16.00
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1299144
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 73
	Minor (reclaiming a frame) page faults: 370281
	Voluntary context switches: 12520
	Involuntary context switches: 30830
	Swaps: 0
	File system inputs: 1195272
	File system outputs: 261192
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 09:07
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,221
find_nn+update_center_time,417
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,226
find_nn+update_center_time,430
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,180
find_nn+update_center_time,389
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,182
find_nn+update_center_time,399
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,180
find_nn+update_center_time,180
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1120, 4096, 128, 16384, 41984]
polyfit coeff: [ 2.80662366e+00 -4.65866667e+03]
resultant func:  
2.807 x - 4659
train time:  57.99126958847046  add time:  62.4003164768219  construction time:  120.39158606529236
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random construction 1"
	User time (seconds): 2396.26
	System time (seconds): 7.35
	Percent of CPU this job got: 1953%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:03.03
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1300724
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 368917
	Voluntary context switches: 11591
	Involuntary context switches: 25513
	Swaps: 0
	File system inputs: 8
	File system outputs: 261192
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 09:11
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,216
find_nn+update_center_time,468
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,209
find_nn+update_center_time,473
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,180
find_nn+update_center_time,410
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,184
find_nn+update_center_time,420
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,214
find_nn+update_center_time,214
Start to update posting lists
===== Threshold selection ====
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1120, 4096, 8192, 16384, 65536]
polyfit coeff: [ 4.23853763e+00 -7.21333333e+03]
resultant func:  
4.239 x - 7213
train time:  57.05807328224182  add time:  68.43644428253174  construction time:  125.49451756477356
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random construction 1"
	User time (seconds): 2864.40
	System time (seconds): 7.15
	Percent of CPU this job got: 2242%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:08.04
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1298700
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 344893
	Voluntary context switches: 11247
	Involuntary context switches: 30519
	Swaps: 0
	File system inputs: 8
	File system outputs: 261184
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 09:17
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,200
find_nn+update_center_time,420
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,194
find_nn+update_center_time,419
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,181
find_nn+update_center_time,413
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,225
find_nn+update_center_time,456
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,179
find_nn+update_center_time,179
Start to update posting lists
===== Threshold selection ====
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1152, 2688, 8192, 16384, 65536]
polyfit coeff: [ 4.27716129e+00 -7.72800000e+03]
resultant func:  
4.277 x - 7728
train time:  55.084657430648804  add time:  69.48426556587219  construction time:  124.568922996521
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random construction 1"
	User time (seconds): 2857.78
	System time (seconds): 7.66
	Percent of CPU this job got: 2246%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:07.56
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1300444
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 373642
	Voluntary context switches: 12154
	Involuntary context switches: 30087
	Swaps: 0
	File system inputs: 8
	File system outputs: 261176
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 09:23
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,200
find_nn+update_center_time,397
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,179
find_nn+update_center_time,388
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,181
find_nn+update_center_time,391
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,181
find_nn+update_center_time,395
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,215
find_nn+update_center_time,215
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1152, 128, 6144, 16384, 65536]
polyfit coeff: [ 4.37969892e+00 -9.28533333e+03]
resultant func:  
4.38 x - 9285
train time:  60.996089220047  add time:  65.892404794693  construction time:  126.88849401473999
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random construction 1"
	User time (seconds): 2369.32
	System time (seconds): 7.26
	Percent of CPU this job got: 1836%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:09.40
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1299232
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 363990
	Voluntary context switches: 9774
	Involuntary context switches: 25643
	Swaps: 0
	File system inputs: 8
	File system outputs: 261192
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 09:27
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,203
find_nn+update_center_time,441
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,228
find_nn+update_center_time,501
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,185
find_nn+update_center_time,406
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,183
find_nn+update_center_time,419
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,221
find_nn+update_center_time,221
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1120, 4096, 128, 16384, 65536]
polyfit coeff: [ 4.35776344e+00 -9.56533333e+03]
resultant func:  
4.358 x - 9565
train time:  56.69613862037659  add time:  62.04049062728882  construction time:  118.7366292476654
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random construction 1"
	User time (seconds): 2380.74
	System time (seconds): 7.22
	Percent of CPU this job got: 1966%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:01.45
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1300280
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 344874
	Voluntary context switches: 9712
	Involuntary context switches: 24319
	Swaps: 0
	File system inputs: 8
	File system outputs: 261184
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 09:33
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,217
find_nn+update_center_time,413
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,179
find_nn+update_center_time,385
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,227
find_nn+update_center_time,439
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,180
find_nn+update_center_time,393
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,180
find_nn+update_center_time,180
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1152, 128, 8192, 128, 65536]
polyfit coeff: [ 4.15277419e+00 -1.07200000e+04]
resultant func:  
4.153 x - 1.072e+04
train time:  61.25021052360535  add time:  58.10296964645386  construction time:  119.3531801700592
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random construction 1"
	User time (seconds): 1874.41
	System time (seconds): 7.07
	Percent of CPU this job got: 1544%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:01.84
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1298076
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 351851
	Voluntary context switches: 7748
	Involuntary context switches: 153288
	Swaps: 0
	File system inputs: 8
	File system outputs: 261216
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 09:39
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,193
find_nn+update_center_time,405
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,220
find_nn+update_center_time,442
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,179
find_nn+update_center_time,412
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,226
find_nn+update_center_time,462
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,198
find_nn+update_center_time,198
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1120, 4096, 8192, 128, 128]
polyfit coeff: [-2.65892473e-01  4.38133333e+03]
resultant func:  
-0.2659 x + 4381
train time:  60.044167041778564  add time:  55.138646602630615  construction time:  115.18281364440918
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random construction 1"
	User time (seconds): 1874.19
	System time (seconds): 7.31
	Percent of CPU this job got: 1596%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 1:57.82
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1297608
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 343763
	Voluntary context switches: 7924
	Involuntary context switches: 19010
	Swaps: 0
	File system inputs: 16
	File system outputs: 261184
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 09:44
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,198
find_nn+update_center_time,412
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,194
find_nn+update_center_time,420
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,208
find_nn+update_center_time,437
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,217
find_nn+update_center_time,449
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,212
find_nn+update_center_time,212
Start to update posting lists
===== Threshold selection ====
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1184, 4096, 8192, 16384, 65536]
polyfit coeff: [ 4.23630108e+00 -7.18666667e+03]
resultant func:  
4.236 x - 7187
train time:  61.91526794433594  add time:  72.29130411148071  construction time:  134.20657205581665
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random construction 1"
	User time (seconds): 2892.05
	System time (seconds): 7.14
	Percent of CPU this job got: 2119%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:16.76
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1297460
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 372547
	Voluntary context switches: 12829
	Involuntary context switches: 30699
	Swaps: 0
	File system inputs: 8
	File system outputs: 261192
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 17:28
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,191
find_nn+update_center_time,409
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,189
find_nn+update_center_time,417
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,184
find_nn+update_center_time,415
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,186
find_nn+update_center_time,422
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,183
find_nn+update_center_time,183
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1152, 128, 128, 128, 44032]
polyfit coeff: [ 2.85574194e+00 -8.59200000e+03]
resultant func:  
2.856 x - 8592
train time:  54.84367275238037  add time:  48.99145221710205  construction time:  103.83512496948242
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/attr_sel_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/qrangesel_1_1_2_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_random/sif_gt_sel_1_1_2_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_random construction 1"
	User time (seconds): 1408.83
	System time (seconds): 7.04
	Percent of CPU this job got: 1335%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 1:46.03
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1300076
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 363867
	Voluntary context switches: 8667
	Involuntary context switches: 26811
	Swaps: 0
	File system inputs: 0
	File system outputs: 261072
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 19:02
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/attr_sel_1_2_in_dist.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/qrangesel_1_1_2_in_dist.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/sif_gt_sel_1_1_2_in_dist_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_in_dist
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,206
find_nn+update_center_time,459
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,208
find_nn+update_center_time,485
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,199
find_nn+update_center_time,477
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,201
find_nn+update_center_time,485
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,219
find_nn+update_center_time,219
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [128, 2368, 128, 128, 37888]
polyfit coeff: [ 2.42365591e+00 -6.89866667e+03]
resultant func:  
2.424 x - 6899
train time:  57.19524121284485  add time:  54.41246819496155  construction time:  111.6077094078064
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_in_dist
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/attr_sel_1_2_in_dist.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/qrangesel_1_1_2_in_dist.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/sif_gt_sel_1_1_2_in_dist_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_in_dist construction 1"
	User time (seconds): 1463.56
	System time (seconds): 7.22
	Percent of CPU this job got: 1292%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 1:53.80
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1298820
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 368888
	Voluntary context switches: 13328
	Involuntary context switches: 34674
	Swaps: 0
	File system inputs: 0
	File system outputs: 261200
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 19:08
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/attr_sel_1_2_in_dist.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/qrangesel_1_1_2_in_dist.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/sif_gt_sel_1_1_2_in_dist_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_in_dist
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,202
find_nn+update_center_time,403
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,199
find_nn+update_center_time,410
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,200
find_nn+update_center_time,411
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,201
find_nn+update_center_time,415
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,211
find_nn+update_center_time,211
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [128, 128, 128, 128, 36864]
polyfit coeff: [ 2.41944086e+00 -7.52533333e+03]
resultant func:  
2.419 x - 7525
train time:  55.884817600250244  add time:  42.75432348251343  construction time:  98.63914108276367
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_in_dist
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/attr_sel_1_2_in_dist.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/qrangesel_1_1_2_in_dist.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/sif_gt_sel_1_1_2_in_dist_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_in_dist construction 1"
	User time (seconds): 940.93
	System time (seconds): 7.14
	Percent of CPU this job got: 940%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 1:40.83
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1301260
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 345673
	Voluntary context switches: 7937
	Involuntary context switches: 25262
	Swaps: 0
	File system inputs: 0
	File system outputs: 261184
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 19:12
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/attr_sel_1_2_in_dist.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/qrangesel_1_1_2_in_dist.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/sif_gt_sel_1_1_2_in_dist_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_in_dist
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,196
find_nn+update_center_time,427
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,204
find_nn+update_center_time,434
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,198
find_nn+update_center_time,426
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,202
find_nn+update_center_time,436
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,210
find_nn+update_center_time,210
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [128, 128, 5376, 16384, 128]
polyfit coeff: [1.19053763e-01 3.69066667e+03]
resultant func:  
0.1191 x + 3691
train time:  59.59387445449829  add time:  50.66873288154602  construction time:  110.26260733604431
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_in_dist
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/attr_sel_1_2_in_dist.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/qrangesel_1_1_2_in_dist.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/sif_gt_sel_1_1_2_in_dist_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_in_dist construction 1"
	User time (seconds): 1461.29
	System time (seconds): 7.28
	Percent of CPU this job got: 1306%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 1:52.43
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1299700
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 343266
	Voluntary context switches: 11988
	Involuntary context switches: 35247
	Swaps: 0
	File system inputs: 0
	File system outputs: 261192
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 19:21
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/attr_sel_1_2_in_dist.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/qrangesel_1_1_2_in_dist.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/sif_gt_sel_1_1_2_in_dist_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_in_dist
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Traceback (most recent call last):
  File "utils/test_rii.py", line 113, in <module>
    codec = nanopq.PQ(M=M).fit(vecs=train)  # Trained using Xt
  File "/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/nanopq/pq.py", line 123, in fit
    self.codewords[m], _ = kmeans2(vecs_sub, self.Ks, iter=iter, minit=minit)
  File "/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py", line 786, in kmeans2
    label = vq(data, code_book)[0]
  File "/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py", line 209, in vq
    return _vq.vq(c_obs, c_code_book)
KeyboardInterrupt
Command terminated by signal 2
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/attr_sel_1_2_in_dist.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/qrangesel_1_1_2_in_dist.json /mnt/data/mocheng/dataset/sift/label/sel_1_2_in_dist/sif_gt_sel_1_1_2_in_dist_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_2_in_dist construction 1"
	User time (seconds): 62.96
	System time (seconds): 5.92
	Percent of CPU this job got: 138%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 0:49.56
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1055464
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 44064
	Voluntary context switches: 200
	Involuntary context switches: 276
	Swaps: 0
	File system inputs: 24
	File system outputs: 72
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 20:18
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_5_random/attr_sel_1_5_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_5_random/qrangesel_1_1_5_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_5_random/sif_gt_sel_1_1_5_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_5_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,218
find_nn+update_center_time,460
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,201
find_nn+update_center_time,459
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,218
find_nn+update_center_time,473
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,198
find_nn+update_center_time,465
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,216
find_nn+update_center_time,216
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [128, 2432, 128, 128, 128]
polyfit coeff: [-6.50322581e-02  9.92000000e+02]
resultant func:  
-0.06503 x + 992
train time:  62.956671476364136  add time:  45.87808609008789  construction time:  108.83475756645203
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_5_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_5_random/attr_sel_1_5_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_5_random/qrangesel_1_1_5_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_5_random/sif_gt_sel_1_1_5_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_5_random construction 1"
	User time (seconds): 931.73
	System time (seconds): 7.40
	Percent of CPU this job got: 845%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 1:51.02
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1301188
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 345761
	Voluntary context switches: 6600
	Involuntary context switches: 18727
	Swaps: 0
	File system inputs: 0
	File system outputs: 261184
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 22:27
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,211
find_nn+update_center_time,421
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,228
find_nn+update_center_time,448
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,213
find_nn+update_center_time,437
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,202
find_nn+update_center_time,429
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,213
find_nn+update_center_time,213
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1088, 128, 5504, 128, 65536]
polyfit coeff: [ 4.19475269e+00 -1.15306667e+04]
resultant func:  
4.195 x - 1.153e+04
train time:  61.9291729927063  add time:  60.88056206703186  construction time:  122.80973505973816
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random construction 1"
	User time (seconds): 1964.08
	System time (seconds): 7.32
	Percent of CPU this job got: 1576%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:05.01
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1297672
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 370357
	Voluntary context switches: 13667
	Involuntary context switches: 34865
	Swaps: 0
	File system inputs: 0
	File system outputs: 261208
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 02:35
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,203
find_nn+update_center_time,406
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,225
find_nn+update_center_time,443
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,183
find_nn+update_center_time,403
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,179
find_nn+update_center_time,403
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,197
find_nn+update_center_time,197
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1152, 2624, 128, 16384, 128]
polyfit coeff: [9.04086022e-02 3.52266667e+03]
resultant func:  
0.09041 x + 3523
train time:  60.545737504959106  add time:  59.536253690719604  construction time:  120.08199119567871
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random construction 1"
	User time (seconds): 1882.22
	System time (seconds): 7.00
	Percent of CPU this job got: 1540%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:02.67
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1298516
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 345551
	Voluntary context switches: 7606
	Involuntary context switches: 20103
	Swaps: 0
	File system inputs: 8
	File system outputs: 261192
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 03:34
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,211
find_nn+update_center_time,466
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,180
find_nn+update_center_time,447
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,195
find_nn+update_center_time,464
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,194
find_nn+update_center_time,468
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,181
find_nn+update_center_time,181
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1152, 4096, 128, 128, 128]
polyfit coeff: [-1.47784946e-01  2.04266667e+03]
resultant func:  
-0.1478 x + 2043
train time:  59.01893877983093  add time:  51.009971141815186  construction time:  110.02890992164612
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random construction 1"
	User time (seconds): 1384.33
	System time (seconds): 7.12
	Percent of CPU this job got: 1240%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 1:52.19
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1298688
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 368027
	Voluntary context switches: 5738
	Involuntary context switches: 15196
	Swaps: 0
	File system inputs: 0
	File system outputs: 261200
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 05:07
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,225
find_nn+update_center_time,429
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,214
find_nn+update_center_time,429
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,214
find_nn+update_center_time,429
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,204
find_nn+update_center_time,434
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,241
find_nn+update_center_time,241
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [128, 2560, 128, 16384, 128]
polyfit coeff: [1.280e-01 3.072e+03]
resultant func:  
0.128 x + 3072
train time:  55.544758319854736  add time:  49.209871768951416  construction time:  104.75463008880615
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random construction 1"
	User time (seconds): 1430.50
	System time (seconds): 7.11
	Percent of CPU this job got: 1344%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 1:46.93
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1297076
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 374576
	Voluntary context switches: 8925
	Involuntary context switches: 26703
	Swaps: 0
	File system inputs: 0
	File system outputs: 261192
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 06:41
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json
query range file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
mode: construction
label cnt: 1
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,224
find_nn+update_center_time,423
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,212
find_nn+update_center_time,423
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,217
find_nn+update_center_time,432
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,182
find_nn+update_center_time,401
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,193
find_nn+update_center_time,193
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [1152, 2624, 8192, 128, 65536]
polyfit coeff: [ 4.08232258e+00 -9.78400000e+03]
resultant func:  
4.082 x - 9784
train time:  57.042216300964355  add time:  62.5774302482605  construction time:  119.61964654922485
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/attr_sel_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/qrangesel_1_1_100_random.json /mnt/data/mocheng/dataset/sift/label/sel_1_100_random/sif_gt_sel_1_1_100_random_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_100_random construction 1"
	User time (seconds): 2369.20
	System time (seconds): 7.25
	Percent of CPU this job got: 1951%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:01.78
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1300640
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 351726
	Voluntary context switches: 10142
	Involuntary context switches: 28553
	Swaps: 0
	File system inputs: 0
	File system outputs: 261192
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
