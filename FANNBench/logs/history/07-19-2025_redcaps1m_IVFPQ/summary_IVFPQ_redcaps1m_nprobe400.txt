Start time: 00:02
====================
START: running TEST_IVFPQ, sift data --

dataset: redcaps1m
N: 1000000
topk: 100
threads: 1
dataset file: /mnt/data/mocheng/dataset/redcaps1m/image_embeddings.fvecs
query file: /mnt/data/mocheng/dataset/redcaps1m/query.fvecs
attr file: /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
qrange file: /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/qrangesel_6_2_100000_random_6.json
gt file: /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/sif_gt_sel_6_2_100000_random_6_100.json
index file: /mnt/data/mocheng/dataset/redcaps1m/ivfpq/index/index_ivfpq_sel_2_100000_random_512
nprobe: 400
dim: 512
loaded base attributes from:/mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
[ 0.138s ] Loaded metadata, 2000000 attr's found
[ 0.138s ] Loading query vectors and attributes
query vecs data loaded, with dim: 512, nb=10000
[ 0.150s ] Loaded query vectors from /mnt/data/mocheng/dataset/redcaps1m/query.fvecs
[ 0.153s ] Loaded 10000 redcaps1m queries
[ 0.218s ] Loaded ground truth, gt_size: 100
[ 0.218s ] Index Params -- d: 512, N: 1000000
 load index size: 1000000
--Index created
==============================================
====================Search Results====================
==============================================
==============================================
====================Search====================
==============================================
==================== IVFPQ INDEX ====================
[ 3.588s ] Searching the 100 nearest neighbors of 10000 vectors in the index
selectivity: 0.501
[ 594.635s ] Query results (vector ids, then distances):
query 0 nn's (6, 1058, 84346): 727106 (6) 562528 (19) 646437 (4080) 864174 (6) 451328 (6) 64073 (3080) 302070 (6) 812018 (10) 7102 (10) 880422 (10) 265404 (10) 302187 (23894) 989732 (10) 807005 (60325) 966838 (10) 571852 (6) 465841 (13037) 999703 (21691) 838133 (75990) 988753 (33012) 754695 (43532) 135244 (6) 548160 (6) 554724 (6) 91712 (19) 256653 (90888) 410711 (68762) 628377 (79459) 618562 (10) 800767 (41692) 708925 (62506) 968022 (6) 678814 (6) 760995 (70130) 449397 (90944) 46518 (10) 119431 (30985) 75346 (6) 131965 (5450) 103714 (10) 997239 (26220) 983533 (39939) 602879 (15553) 412764 (10) 909887 (58063) 268357 (62092) 629113 (33463) 519797 (23321) 801629 (18017) 124180 (10) 813377 (47257) 699054 (6) 720013 (10576) 595417 (89761) 930214 (6) 86846 (6) 478100 (6) 953733 (63245) 983152 (6) 686231 (14080) 763265 (340) 823706 (6) 393589 (46582) 679931 (21123) 71366 (6) 318225 (90503) 670823 (97529) 492624 (10) 507797 (15223) 730346 (6) 422643 (37322) 952583 (55952) 211611 (21778) 980277 (62763) 985228 (6) 274798 (6) 996728 (19) 399187 (29429) 154883 (74740) 553713 (6679) 934902 (19) 100426 (6) 827447 (43955) 105181 (49459) 276948 (19) 707913 (70233) 323117 (87761) 13080 (10) 726200 (6) 514653 (84519) 958477 (83960) 549870 (6) 556864 (185) 636719 (77455) 448032 (20) 654498 (10) 592395 (95298) 890540 (6) 950362 (6) 345358 (6) 
     dis: 	0.632 0.638 0.691 0.741 0.742 0.750 0.755 0.760 0.761 0.768 0.771 0.789 0.791 0.791 0.804 0.807 0.808 0.811 0.819 0.819 0.825 0.828 0.830 0.837 0.844 0.848 0.851 0.852 0.857 0.862 0.863 0.864 0.871 0.875 0.877 0.878 0.879 0.880 0.880 0.882 0.885 0.890 0.891 0.893 0.893 0.894 0.895 0.896 0.897 0.898 0.898 0.899 0.900 0.900 0.901 0.903 0.903 0.903 0.904 0.905 0.905 0.905 0.905 0.905 0.906 0.906 0.906 0.909 0.910 0.910 0.910 0.911 0.911 0.912 0.912 0.912 0.916 0.917 0.918 0.918 0.918 0.919 0.920 0.920 0.923 0.924 0.924 0.924 0.927 0.927 0.928 0.928 0.929 0.929 0.931 0.931 0.931 0.931 0.931 0.931 
query 1 nn's (6, 7061, 90400): 741325 (9382) 660394 (19) 622447 (83917) 964028 (6) 199154 (6) 427146 (6) 361663 (21698) 361537 (83842) 428754 (6) 30989 (38653) 427957 (5106) 8069 (40451) 667007 (14548) 994014 (10) 964018 (10) 928093 (59314) 549356 (19) 457200 (6) 104425 (90651) 661716 (370) 832389 (26182) 997966 (10) 630058 (10) 710350 (10) 352390 (10) 163712 (6) 866328 (20) 602578 (6) 848037 (39391) 671340 (20) 326649 (13699) 925374 (6) 424951 (86143) 709969 (73782) 272839 (36518) 681550 (6) 86984 (10) 743973 (1054) 371263 (39269) 526151 (21612) 885087 (50563) 75356 (10) 408156 (10) 333978 (6) 395948 (6) 903716 (6) 265490 (6) 698433 (11563) 964128 (6) 753841 (94284) 620586 (6) 925657 (98587) 721597 (78597) 766866 (6) 271263 (33091) 557922 (6) 218175 (5605) 39189 (12241) 517347 (73170) 304095 (71583) 110364 (6) 418536 (6) 935736 (20) 391208 (10) 105750 (6) 837200 (6) 107066 (6) 489550 (6) 80871 (59124) 44827 (22746) 239477 (96193) 457256 (6) 55881 (3171) 320140 (10) 295835 (71766) 235619 (29771) 62978 (6) 858634 (20) 116279 (39082) 473208 (6) 766697 (51704) 387184 (10) 388764 (10) 791914 (6) 288542 (293) 253736 (10) 820498 (6) 672841 (14117) 417828 (20) 213143 (21833) 671475 (17965) 30708 (6) 58319 (52527) 785513 (35558) 663858 (285) 86484 (6) 865350 (6) 885260 (6) 601939 (52744) 344524 (6) 
     dis: 	0.100 0.103 0.103 0.106 0.106 0.106 0.106 0.107 0.108 0.109 0.111 0.112 0.112 0.112 0.113 0.113 0.114 0.115 0.115 0.116 0.116 0.116 0.117 0.117 0.117 0.117 0.117 0.118 0.118 0.118 0.119 0.119 0.119 0.119 0.120 0.120 0.120 0.120 0.120 0.121 0.121 0.121 0.122 0.122 0.122 0.122 0.122 0.122 0.122 0.123 0.123 0.123 0.123 0.123 0.123 0.124 0.124 0.124 0.125 0.125 0.125 0.126 0.126 0.126 0.126 0.126 0.126 0.126 0.127 0.127 0.127 0.127 0.127 0.128 0.128 0.128 0.129 0.129 0.129 0.129 0.129 0.130 0.130 0.130 0.130 0.130 0.131 0.131 0.131 0.131 0.131 0.131 0.131 0.131 0.131 0.131 0.131 0.131 0.132 0.132 
query 2 nn's (6, 16654, 99978): 355537 (64184) 880455 (86265) 964377 (94796) 306439 (57083) 757728 (6) 193180 (10) 75885 (4390) 410774 (10) 620585 (91800) 273250 (10) 374226 (10) 71515 (37413) 894254 (10) 118823 (61921) 903106 (6) 534302 (10) 160133 (15010) 792564 (6) 328504 (6) 737868 (6) 161603 (41341) 498270 (6) 435452 (6) 929527 (69064) 980872 (6) 633139 (60068) 507734 (6) 971858 (6) 625921 (7910) 800558 (10) 665039 (42546) 889521 (57741) 471110 (6) 381411 (32823) 952981 (81018) 24425 (41749) 93860 (6) 222697 (86740) 623737 (57707) 498025 (65519) 33572 (6) 627502 (10) 10316 (6) 476689 (20756) 726914 (6) 492525 (60105) 633598 (6) 604084 (19) 339255 (63555) 317022 (10) 79399 (99852) 541937 (98118) 870630 (6) 230054 (6) 341373 (36924) 403717 (33301) 72372 (20) 491378 (6) 136876 (19) 904824 (10) 4660 (19) 17779 (57141) 509068 (10) 994934 (6) 561163 (42349) 785259 (16842) 261708 (10) 192832 (6) 327556 (6) 184796 (10) 72167 (6742) 645543 (39063) 304775 (71717) 625576 (6) 780551 (80280) 470869 (46133) 337778 (10) 74992 (6) 459595 (79588) 490170 (20) 44865 (33810) 550905 (71616) 319345 (57521) 660131 (66650) 588334 (6) 435592 (10) 87145 (72382) 965924 (10) 166621 (22350) 677252 (10) 245232 (6) 89667 (61935) 962379 (41975) 258161 (27256) 623030 (6) 752639 (2469) 259618 (19) 906792 (6) 215560 (10) 351702 (19) 
     dis: 	0.223 0.225 0.226 0.238 0.240 0.249 0.257 0.258 0.259 0.262 0.262 0.263 0.264 0.265 0.268 0.269 0.271 0.271 0.273 0.275 0.276 0.276 0.277 0.280 0.282 0.283 0.283 0.283 0.284 0.284 0.284 0.284 0.285 0.285 0.285 0.286 0.287 0.288 0.288 0.289 0.289 0.290 0.290 0.291 0.292 0.293 0.294 0.294 0.295 0.295 0.295 0.296 0.296 0.296 0.297 0.297 0.297 0.297 0.298 0.299 0.299 0.300 0.300 0.301 0.301 0.302 0.302 0.302 0.302 0.303 0.303 0.303 0.303 0.303 0.303 0.303 0.303 0.304 0.305 0.305 0.305 0.305 0.306 0.306 0.306 0.307 0.307 0.307 0.307 0.307 0.307 0.308 0.308 0.309 0.309 0.309 0.309 0.309 0.310 0.310 
query 3 nn's (6, 310, 83602): 689368 (6) 124464 (6) 595884 (10) 461110 (6) 889856 (10) 609006 (10) 213744 (6) 306883 (54086) 483626 (6) 128901 (75430) 382748 (6) 246538 (6) 369955 (5677) 525367 (57874) 183160 (6) 27812 (6) 340980 (6) 669781 (42763) 421931 (78567) 336546 (6) 605862 (6) 758927 (87680) 390342 (6) 471055 (91300) 622714 (20) 226331 (48653) 899709 (93499) 671717 (54053) 345300 (19) 640563 (66936) 170065 (82838) 43568 (10) 465820 (6) 431136 (6) 225830 (6) 4433 (72016) 397607 (99196) 123733 (95818) 301836 (10) 994604 (6) 696027 (16916) 391302 (6) 595472 (6) 800827 (25049) 585483 (52378) 472875 (42570) 902091 (61877) 663784 (10) 555688 (19) 460597 (54673) 634766 (6) 882799 (86939) 17746 (6) 672565 (2235) 684978 (10) 184010 (6) 459020 (10) 98458 (6) 578140 (10) 430216 (6) 495743 (18613) 382010 (10) 661987 (54835) 423285 (33929) 280271 (44956) 328860 (6) 694334 (10) 553746 (20) 677322 (10) 412295 (36063) 358247 (64245) 323021 (25841) 191420 (6) 242265 (79360) 840055 (62628) 669242 (6) 97563 (40560) 340090 (6) 493967 (76990) 944408 (6) 214834 (20) 723056 (6) 480847 (31275) 705993 (24937) 706869 (57024) 451329 (36862) 986735 (68449) 119088 (6) 101336 (6) 296579 (12914) 208521 (91907) 948385 (85966) 130248 (6) 521807 (81796) 243984 (6) 90074 (6) 935542 (19) 430670 (6) 302971 (87929) 268388 (20) 
     dis: 	0.402 0.447 0.461 0.463 0.463 0.464 0.475 0.476 0.496 0.497 0.500 0.503 0.503 0.505 0.510 0.510 0.515 0.515 0.515 0.516 0.517 0.517 0.518 0.521 0.521 0.522 0.523 0.525 0.526 0.527 0.528 0.531 0.532 0.532 0.532 0.533 0.533 0.534 0.536 0.537 0.537 0.538 0.539 0.539 0.539 0.541 0.541 0.542 0.543 0.544 0.544 0.545 0.546 0.546 0.546 0.547 0.548 0.549 0.549 0.549 0.550 0.550 0.552 0.552 0.552 0.553 0.553 0.555 0.557 0.559 0.560 0.560 0.561 0.561 0.561 0.561 0.561 0.561 0.562 0.563 0.563 0.564 0.564 0.565 0.565 0.565 0.566 0.566 0.566 0.566 0.566 0.567 0.567 0.567 0.567 0.567 0.567 0.567 0.568 0.568 
query 4 nn's (6, 10534, 93885): 582698 (10) 189529 (80737) 931553 (69580) 598411 (49936) 892178 (6) 421184 (10) 315361 (25656) 886608 (20) 191044 (6) 227862 (10) 279888 (10) 700754 (6) 556169 (48410) 231993 (42297) 54130 (10) 60658 (6) 589135 (99798) 929991 (26071) 105030 (6) 137605 (59533) 189525 (69835) 403555 (65519) 836141 (49932) 455512 (10) 908309 (52821) 834676 (6) 565451 (5882) 222228 (6) 218677 (35141) 222372 (6) 902523 (1971) 979493 (13424) 910110 (6) 330129 (72104) 676341 (56915) 540625 (21461) 861337 (61972) 481846 (6) 765148 (6) 567017 (56032) 941111 (43560) 18995 (51861) 351217 (48761) 870723 (45745) 262612 (10) 282395 (91307) 673629 (90439) 655488 (10) 187698 (6) 702801 (57137) 857192 (6) 805996 (6) 590482 (10) 599829 (79805) 51681 (10386) 994687 (92704) 678901 (70620) 500007 (39177) 829234 (6) 511053 (93818) 577889 (96452) 732037 (26394) 49802 (6) 104778 (6) 982040 (6) 309894 (6) 411866 (19) 842541 (48791) 476701 (46683) 584115 (71290) 183252 (6) 948602 (10) 714666 (10) 775861 (75140) 63749 (51420) 113996 (10) 618358 (10) 323483 (22296) 20949 (28775) 948484 (6) 341328 (19) 367708 (6) 717879 (30891) 569466 (326) 244038 (10) 392242 (6) 792481 (68087) 917512 (6) 510334 (19) 760002 (6) 43574 (6) 573896 (6) 446346 (6) 395799 (97749) 311214 (19) 464808 (6) 676002 (10) 101369 (22704) 75268 (6) 56749 (25871) 
     dis: 	0.260 0.280 0.283 0.286 0.288 0.289 0.296 0.298 0.300 0.302 0.302 0.304 0.306 0.307 0.308 0.309 0.315 0.317 0.317 0.317 0.318 0.318 0.318 0.318 0.319 0.320 0.321 0.323 0.324 0.324 0.324 0.325 0.325 0.326 0.326 0.327 0.328 0.329 0.329 0.329 0.329 0.330 0.331 0.331 0.332 0.333 0.334 0.334 0.334 0.335 0.335 0.335 0.335 0.335 0.335 0.337 0.337 0.337 0.338 0.338 0.338 0.338 0.339 0.339 0.340 0.340 0.340 0.341 0.342 0.343 0.344 0.344 0.344 0.344 0.344 0.345 0.346 0.346 0.346 0.346 0.346 0.347 0.348 0.348 0.348 0.348 0.348 0.348 0.348 0.348 0.349 0.349 0.350 0.350 0.350 0.352 0.352 0.352 0.353 0.353 
[ 594.636s ] *** Query time: 538.105
qps: 18.584
 *** ivfpq recall 
ivfpq get 990943 postive res from 1000000 results, recall@100:0.991
recall dist(10% per bucket): 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.001 0.631 0.369 
finished ivfpq index examples
[ 594.666s ] -----DONE-----
	Command being timed: "../faiss/build/demos/ivfpq_query_arbi redcaps1m 1000000 100 1 /mnt/data/mocheng/dataset/redcaps1m/image_embeddings.fvecs /mnt/data/mocheng/dataset/redcaps1m/query.fvecs /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/attr_sel_2_100000_random.json /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/qrangesel_6_2_100000_random_6.json /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/sif_gt_sel_6_2_100000_random_6_100.json /mnt/data/mocheng/dataset/redcaps1m/ivfpq/index/index_ivfpq_sel_2_100000_random_512 400 512"
	User time (seconds): 591.59
	System time (seconds): 2.65
	Percent of CPU this job got: 99%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 9:54.82
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 2625448
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 656350
	Voluntary context switches: 2497
	Involuntary context switches: 297
	Swaps: 0
	File system inputs: 125736
	File system outputs: 32
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 01:26
====================
START: running TEST_IVFPQ, sift data --

dataset: redcaps1m
N: 1000000
topk: 100
threads: 1
dataset file: /mnt/data/mocheng/dataset/redcaps1m/image_embeddings.fvecs
query file: /mnt/data/mocheng/dataset/redcaps1m/query.fvecs
attr file: /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
qrange file: /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/qrangesel_10_2_100000_random_10.json
gt file: /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/sif_gt_sel_10_2_100000_random_10_100.json
index file: /mnt/data/mocheng/dataset/redcaps1m/ivfpq/index/index_ivfpq_sel_2_100000_random_512
nprobe: 400
dim: 512
loaded base attributes from:/mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
[ 0.139s ] Loaded metadata, 2000000 attr's found
[ 0.139s ] Loading query vectors and attributes
query vecs data loaded, with dim: 512, nb=10000
[ 0.151s ] Loaded query vectors from /mnt/data/mocheng/dataset/redcaps1m/query.fvecs
[ 0.153s ] Loaded 10000 redcaps1m queries
[ 0.220s ] Loaded ground truth, gt_size: 100
[ 0.220s ] Index Params -- d: 512, N: 1000000
 load index size: 1000000
--Index created
==============================================
====================Search Results====================
==============================================
==============================================
====================Search====================
==============================================
==================== IVFPQ INDEX ====================
[ 2.963s ] Searching the 100 nearest neighbors of 10000 vectors in the index
selectivity: 0.100
[ 411.172s ] Query results (vector ids, then distances):
query 0 nn's (10, 66234, 99627): 268161 (96264) 549163 (84314) 334544 (10) 766737 (23599) 49228 (10) 606467 (78112) 596166 (6) 966405 (71092) 825029 (27658) 533175 (43041) 174023 (64856) 472918 (6) 331521 (12022) 295694 (6) 370277 (48513) 517012 (10) 36195 (42176) 809902 (20) 700827 (22992) 949111 (13166) 317245 (33151) 289857 (74604) 618750 (6) 679902 (6) 475136 (187) 70830 (20) 897196 (6) 603566 (10) 881255 (45604) 167 (7761) 671123 (400) 947396 (10) 482283 (69525) 549207 (4529) 510827 (28909) 878418 (10) 667161 (5666) 675650 (10) 141277 (62037) 716428 (10) 335014 (10) 689310 (6) 950097 (45562) 207487 (99001) 152365 (3469) 526743 (50113) 868681 (73465) 419752 (10) 145977 (24542) 484885 (20576) 906170 (6) 112354 (6) 781315 (47407) 604591 (85635) 109409 (29867) 712710 (10) 437061 (68489) 272370 (10) 559394 (6) 692028 (361) 833648 (6) 437827 (6516) 946861 (65023) 100896 (10) 358423 (53854) 556314 (10) 747935 (48047) 289391 (92033) 526005 (73404) 455815 (17121) 49970 (6) 609339 (18410) 511389 (79118) 812392 (19) 52396 (19) 370583 (54553) 595078 (6) 872390 (6) 467713 (2178) 29387 (45987) 112401 (35517) 187395 (43086) 942541 (37758) 892604 (6) 676899 (93771) 450011 (86055) 137288 (6) 460160 (10) 98292 (10) 819101 (24719) 190626 (6) 554374 (6) 964824 (6) 453907 (91917) 163347 (39880) 452890 (6) 128646 (6) 561546 (6) 226909 (53009) 705866 (20) 
     dis: 	0.647 0.761 0.809 0.816 0.827 0.842 0.844 0.846 0.882 0.889 0.906 0.909 0.915 0.920 0.923 0.924 0.926 0.927 0.930 0.932 0.934 0.936 0.939 0.941 0.943 0.946 0.946 0.947 0.947 0.947 0.948 0.949 0.949 0.949 0.952 0.952 0.953 0.954 0.954 0.954 0.955 0.957 0.958 0.958 0.959 0.959 0.959 0.960 0.963 0.963 0.963 0.963 0.964 0.964 0.965 0.965 0.965 0.966 0.967 0.968 0.968 0.968 0.968 0.969 0.970 0.970 0.971 0.972 0.972 0.972 0.973 0.973 0.973 0.974 0.974 0.974 0.975 0.976 0.976 0.976 0.976 0.977 0.977 0.978 0.979 0.979 0.979 0.979 0.979 0.980 0.980 0.980 0.980 0.981 0.981 0.981 0.983 0.983 0.983 0.983 
query 1 nn's (10, 15875, 49153): 728340 (6) 803332 (10) 896567 (65282) 7931 (93555) 399497 (54572) 85059 (61117) 441534 (6) 857939 (9912) 377202 (6) 779657 (40034) 795310 (10) 353761 (78570) 852652 (10) 320719 (18541) 725415 (69804) 115923 (27594) 971318 (6) 135640 (6) 785418 (6) 844021 (64307) 77283 (63746) 485598 (6) 526331 (25633) 822768 (6) 2214 (6) 137079 (97725) 24719 (95711) 915755 (69779) 321493 (58520) 274103 (17918) 79212 (6) 190275 (65566) 349713 (53514) 630758 (6) 434355 (32090) 45666 (6) 51465 (10908) 197972 (6) 960758 (6) 262597 (59213) 770215 (34414) 30217 (39615) 514040 (6) 564195 (74879) 973558 (10) 373120 (6) 547935 (89234) 650379 (12330) 5691 (44043) 498675 (82231) 252090 (10) 462464 (6) 718522 (19) 385587 (65550) 945269 (97743) 177051 (19667) 958041 (2123) 42823 (43691) 500623 (75179) 14490 (10) 592955 (7493) 271998 (6) 782543 (1504) 977847 (22770) 627506 (6) 892547 (20078) 8449 (27962) 339172 (6) 624583 (73599) 742678 (6) 805664 (10) 573989 (18589) 540070 (6) 819946 (10) 436031 (82514) 26423 (33826) 316278 (6) 164441 (14059) 452752 (6) 282638 (6) 151821 (16055) 348487 (68128) 965717 (10148) 905509 (68851) 111699 (29116) 642361 (69039) 772278 (6) 321126 (6) 45745 (63304) 216461 (24874) 284509 (46828) 62581 (80114) 702578 (10) 92737 (7609) 707464 (6) 231377 (62217) 356679 (67716) 446974 (6) 527224 (6) 770426 (10) 
     dis: 	0.101 0.106 0.111 0.114 0.118 0.118 0.118 0.122 0.124 0.124 0.125 0.125 0.126 0.127 0.128 0.129 0.129 0.130 0.130 0.130 0.130 0.132 0.135 0.137 0.137 0.138 0.139 0.140 0.140 0.140 0.140 0.140 0.141 0.141 0.141 0.141 0.142 0.142 0.142 0.142 0.143 0.144 0.144 0.145 0.146 0.146 0.146 0.147 0.147 0.147 0.147 0.147 0.147 0.147 0.148 0.148 0.149 0.149 0.149 0.150 0.150 0.151 0.151 0.152 0.152 0.152 0.152 0.152 0.152 0.153 0.154 0.155 0.155 0.155 0.155 0.156 0.156 0.156 0.156 0.157 0.157 0.158 0.158 0.158 0.159 0.159 0.159 0.159 0.160 0.160 0.160 0.161 0.161 0.161 0.161 0.161 0.161 0.161 0.162 0.162 
query 2 nn's (10, 5684, 39001): 940490 (6) 301614 (6) 773055 (93844) 771849 (63559) 718316 (10) 530996 (10) 995900 (10) 494541 (94906) 328089 (60955) 41616 (6) 919763 (74112) 222791 (9551) 192903 (87059) 88997 (63310) 703151 (76614) 654351 (32327) 325507 (23634) 826279 (19778) 187392 (6) 211045 (98747) 10885 (54367) 785841 (59368) 198935 (14028) 653763 (1512) 600470 (6) 636353 (65304) 197565 (10324) 81672 (10) 770431 (29752) 48588 (6) 84864 (10) 307736 (6) 662063 (67036) 289033 (37621) 748653 (94435) 660306 (69) 278399 (66266) 730117 (49133) 61515 (64154) 985484 (6) 138150 (6) 114422 (6) 235090 (6) 162557 (65291) 714901 (58217) 704918 (6) 524628 (6) 271233 (55149) 784303 (71749) 207461 (75111) 672411 (41515) 963922 (6) 374008 (6) 940866 (6) 710996 (10) 229603 (22997) 834074 (6) 102048 (10) 700245 (92898) 456946 (10) 719881 (96670) 370713 (61421) 80909 (93269) 647739 (94262) 373756 (10) 857578 (10) 96601 (7263) 911190 (6) 750853 (82645) 663798 (6) 940134 (6) 698155 (14683) 204196 (6) 804913 (29868) 143210 (6) 183295 (96295) 911221 (76906) 547457 (50347) 63826 (6) 155543 (31456) 20476 (10) 289705 (78532) 667388 (6) 158052 (19) 695634 (10) 389581 (33432) 937849 (12204) 249354 (10) 240345 (3109) 421020 (6) 883678 (6) 279337 (12618) 790287 (469) 635747 (48430) 972794 (19) 277748 (6) 4032 (192) 604067 (42985) 817407 (92999) 245068 (6) 
     dis: 	0.246 0.262 0.265 0.266 0.269 0.275 0.277 0.277 0.280 0.283 0.284 0.291 0.293 0.301 0.303 0.304 0.304 0.306 0.306 0.308 0.310 0.312 0.313 0.314 0.314 0.317 0.317 0.319 0.319 0.319 0.322 0.323 0.324 0.324 0.324 0.325 0.325 0.326 0.326 0.327 0.327 0.329 0.329 0.329 0.330 0.330 0.331 0.331 0.331 0.332 0.333 0.335 0.336 0.338 0.338 0.338 0.341 0.341 0.341 0.342 0.344 0.344 0.344 0.345 0.345 0.345 0.345 0.346 0.347 0.347 0.347 0.348 0.349 0.349 0.349 0.350 0.350 0.350 0.350 0.351 0.351 0.351 0.352 0.352 0.352 0.352 0.353 0.353 0.353 0.353 0.353 0.354 0.354 0.354 0.354 0.355 0.355 0.355 0.355 0.355 
query 3 nn's (10, 34629, 67933): 640717 (73295) 108295 (63497) 305237 (27829) 269754 (10) 276603 (94801) 469326 (6) 219959 (83862) 480974 (6) 799434 (10) 433518 (10) 241189 (70628) 462436 (6) 807512 (10) 222643 (97093) 681582 (10) 341069 (38447) 434098 (6) 363662 (6) 20577 (10823) 769540 (6) 893013 (39543) 135464 (20) 251240 (6) 163486 (19) 985166 (6) 629321 (37392) 99925 (74238) 535231 (74632) 505362 (10) 283356 (6) 99294 (10) 380504 (6) 945383 (73638) 760060 (6) 686688 (10) 914689 (42434) 271935 (11291) 383377 (43265) 166166 (6) 57618 (6) 102952 (19) 988387 (19751) 571372 (6) 48579 (96401) 128317 (43648) 151545 (29760) 103685 (72190) 177797 (32406) 800226 (19) 585615 (79242) 809774 (6) 560565 (49945) 481579 (38397) 417029 (27905) 136860 (6) 186511 (50995) 604038 (6) 445023 (91053) 758020 (10) 584720 (6) 491677 (17866) 541061 (89315) 469388 (356) 610672 (10) 958845 (17010) 188856 (6) 449487 (6566) 946146 (6) 832818 (19) 516288 (6) 203777 (33105) 826847 (3353) 574333 (457) 630227 (62205) 331567 (92740) 910800 (6) 792951 (81900) 594895 (86969) 437865 (47350) 662161 (17130) 754313 (18194) 780533 (29866) 630733 (21015) 444501 (62341) 416085 (80318) 40835 (12934) 843011 (81975) 784589 (25956) 294364 (6) 372898 (10) 558758 (6) 86837 (19573) 365571 (34160) 808278 (10) 702111 (3840) 617827 (65855) 923134 (6) 309837 (78092) 663026 (6) 989341 (58132) 
     dis: 	0.456 0.510 0.514 0.520 0.522 0.526 0.530 0.535 0.539 0.549 0.552 0.553 0.554 0.556 0.560 0.565 0.569 0.569 0.570 0.572 0.573 0.575 0.576 0.577 0.577 0.578 0.578 0.580 0.582 0.586 0.586 0.589 0.591 0.591 0.593 0.594 0.594 0.596 0.598 0.598 0.598 0.598 0.598 0.601 0.601 0.601 0.604 0.605 0.605 0.607 0.609 0.610 0.612 0.613 0.613 0.615 0.616 0.617 0.618 0.618 0.618 0.619 0.619 0.620 0.620 0.621 0.622 0.622 0.623 0.624 0.624 0.624 0.624 0.625 0.626 0.626 0.626 0.627 0.627 0.627 0.627 0.628 0.628 0.628 0.629 0.629 0.629 0.630 0.632 0.633 0.633 0.633 0.634 0.635 0.636 0.636 0.636 0.637 0.637 0.639 
query 4 nn's (10, 11515, 44854): 695669 (51024) 176027 (11855) 440553 (58185) 742084 (6) 311275 (89697) 604239 (97615) 605725 (34136) 601541 (40926) 65795 (43582) 487840 (6) 760527 (17831) 37748 (6) 954881 (99613) 762488 (10) 954446 (6) 421589 (22133) 940668 (10) 745769 (34671) 863840 (10) 649807 (33515) 853874 (6) 4809 (18468) 56325 (88731) 476522 (6) 664967 (91724) 854292 (6) 976778 (10) 831625 (17083) 503133 (10713) 402334 (10) 220566 (10) 94664 (6) 872328 (10) 452201 (70152) 822335 (65415) 156739 (83689) 100493 (71973) 400425 (42889) 121999 (41725) 694833 (37434) 246737 (76337) 45427 (74) 720233 (463) 91846 (19) 142037 (73719) 129696 (10) 631708 (10) 263530 (6) 446972 (10) 722140 (6) 139238 (6) 79781 (65341) 285861 (38603) 680596 (10) 454150 (19) 649062 (10) 872971 (68008) 688461 (77111) 93793 (72768) 315394 (6) 125613 (46539) 661097 (92252) 48865 (78429) 799986 (10) 779346 (10) 909241 (92805) 694977 (87909) 174389 (74189) 772325 (86188) 328786 (19) 146214 (6) 844596 (10) 155547 (6779) 820668 (6) 567249 (94750) 384599 (89405) 251988 (6) 297465 (51328) 681287 (62529) 36696 (6) 582124 (10) 998359 (59002) 178035 (83705) 156128 (10) 867238 (6) 182189 (46945) 837903 (35437) 703707 (89982) 541032 (19) 238347 (55192) 629286 (6) 907659 (7501) 484651 (13025) 119171 (42114) 684084 (10) 976689 (88658) 939844 (10) 432878 (6) 920775 (83821) 958090 (6) 
     dis: 	0.269 0.269 0.306 0.309 0.323 0.337 0.337 0.337 0.343 0.344 0.345 0.346 0.354 0.356 0.356 0.357 0.358 0.358 0.358 0.362 0.362 0.363 0.368 0.368 0.368 0.369 0.370 0.370 0.372 0.374 0.377 0.378 0.382 0.382 0.383 0.383 0.383 0.384 0.384 0.385 0.385 0.385 0.385 0.386 0.386 0.386 0.391 0.391 0.392 0.392 0.394 0.394 0.394 0.395 0.396 0.396 0.397 0.398 0.399 0.400 0.401 0.401 0.402 0.403 0.403 0.404 0.406 0.406 0.406 0.407 0.408 0.408 0.408 0.409 0.409 0.409 0.409 0.409 0.410 0.410 0.411 0.411 0.412 0.412 0.413 0.413 0.413 0.413 0.414 0.415 0.415 0.416 0.416 0.417 0.418 0.418 0.419 0.420 0.421 0.421 
[ 411.172s ] *** Query time: 360.423
qps: 27.745
 *** ivfpq recall 
ivfpq get 990415 postive res from 1000000 results, recall@100:0.990
recall dist(10% per bucket): 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.002 0.610 0.388 
finished ivfpq index examples
[ 411.203s ] -----DONE-----
	Command being timed: "../faiss/build/demos/ivfpq_query_arbi redcaps1m 1000000 100 1 /mnt/data/mocheng/dataset/redcaps1m/image_embeddings.fvecs /mnt/data/mocheng/dataset/redcaps1m/query.fvecs /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/attr_sel_2_100000_random.json /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/qrangesel_10_2_100000_random_10.json /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/sif_gt_sel_10_2_100000_random_10_100.json /mnt/data/mocheng/dataset/redcaps1m/ivfpq/index/index_ivfpq_sel_2_100000_random_512 400 512"
	User time (seconds): 408.23
	System time (seconds): 3.14
	Percent of CPU this job got: 99%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 6:51.39
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 2626472
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 1174069
	Voluntary context switches: 2
	Involuntary context switches: 608
	Swaps: 0
	File system inputs: 0
	File system outputs: 32
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 02:52
====================
START: running TEST_IVFPQ, sift data --

dataset: redcaps1m
N: 1000000
topk: 100
threads: 1
dataset file: /mnt/data/mocheng/dataset/redcaps1m/image_embeddings.fvecs
query file: /mnt/data/mocheng/dataset/redcaps1m/query.fvecs
attr file: /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
qrange file: /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/qrangesel_19_2_100000_random_19.json
gt file: /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/sif_gt_sel_19_2_100000_random_19_100.json
index file: /mnt/data/mocheng/dataset/redcaps1m/ivfpq/index/index_ivfpq_sel_2_100000_random_512
nprobe: 400
dim: 512
loaded base attributes from:/mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
[ 0.134s ] Loaded metadata, 2000000 attr's found
[ 0.134s ] Loading query vectors and attributes
query vecs data loaded, with dim: 512, nb=10000
[ 0.147s ] Loaded query vectors from /mnt/data/mocheng/dataset/redcaps1m/query.fvecs
[ 0.150s ] Loaded 10000 redcaps1m queries
[ 0.216s ] Loaded ground truth, gt_size: 100
[ 0.216s ] Index Params -- d: 512, N: 1000000
 load index size: 1000000
--Index created
==============================================
====================Search Results====================
==============================================
==============================================
====================Search====================
==============================================
==================== IVFPQ INDEX ====================
[ 2.905s ] Searching the 100 nearest neighbors of 10000 vectors in the index
selectivity: 0.010
[ 323.077s ] Query results (vector ids, then distances):
query 0 nn's (19, 7547, 27573): 460924 (6) 26967 (42492) 747872 (10) 391803 (12568) 123899 (21702) 180898 (10) 226432 (6) 221361 (80695) 197484 (6) 588144 (6) 496985 (86774) 99829 (28414) 848510 (6) 217968 (6) 866249 (5256) 4959 (30306) 16829 (74715) 769804 (6) 380797 (95674) 261833 (98405) 316830 (6) 683503 (53527) 224767 (71456) 296581 (5811) 120539 (49349) 234193 (43663) 992461 (37018) 181778 (6) 591239 (20161) 580864 (6) 991780 (10) 334275 (964) 898620 (6) 76374 (10) 679912 (6) 745855 (44363) 308722 (6) 648092 (6) 43321 (82374) 943892 (10) 252024 (6) 261646 (6) 775772 (6) 537725 (45951) 57020 (6) 75548 (10) 56665 (22767) 373959 (38032) 908289 (17014) 103341 (56591) 614838 (19) 962258 (6) 241904 (6) 464882 (6) 803448 (6) 257709 (36965) 416306 (6) 852559 (59631) 818394 (10) 219086 (6) 377086 (6) 554914 (10) 412815 (90022) 289259 (51425) 381449 (48562) 233390 (19) 88706 (6) 298901 (50547) 342873 (89137) 449549 (63126) 103961 (61793) 395469 (2511) 213784 (10) 706140 (6) 853609 (79452) 628427 (59850) 732710 (10) 625012 (10) 229453 (48365) 678502 (6) 906166 (6) 242957 (83847) 24769 (13191) 59737 (99605) 108433 (25618) 829377 (50206) 95902 (10) 36735 (84012) 954753 (9323) 357948 (19) 242941 (76922) 710420 (6) 790107 (51772) 858632 (6) 820170 (19) 134202 (6) 142920 (6) 738424 (6) 109927 (13185) 262346 (10) 
     dis: 	0.920 0.945 0.946 0.946 0.958 0.959 0.964 0.968 0.973 0.978 0.978 0.980 0.999 0.999 1.001 1.001 1.002 1.002 1.004 1.004 1.006 1.007 1.009 1.009 1.010 1.011 1.012 1.014 1.014 1.015 1.015 1.015 1.016 1.017 1.018 1.019 1.019 1.020 1.020 1.022 1.023 1.024 1.024 1.025 1.025 1.026 1.026 1.026 1.027 1.028 1.029 1.029 1.029 1.031 1.031 1.031 1.033 1.033 1.034 1.036 1.036 1.037 1.038 1.039 1.039 1.039 1.039 1.039 1.040 1.041 1.042 1.043 1.045 1.046 1.046 1.046 1.047 1.047 1.048 1.049 1.049 1.049 1.049 1.049 1.049 1.050 1.050 1.050 1.051 1.051 1.051 1.052 1.052 1.052 1.054 1.054 1.054 1.056 1.056 1.056 
query 1 nn's (19, 19289, 39230): 118532 (6) 654319 (17154) 584544 (6) 946986 (10) 889339 (29860) 702451 (50331) 145137 (64258) 651702 (10) 162918 (6) 254995 (41592) 466014 (6) 204580 (6) 445644 (6) 630147 (62316) 260990 (10) 412334 (6) 706976 (6) 139638 (6) 562974 (6) 890672 (6) 153586 (6) 236057 (4276) 558543 (56898) 368159 (93595) 659701 (35658) 48271 (61443) 753885 (31833) 964312 (6) 184938 (10) 923061 (30081) 245190 (6) 991611 (93134) 716086 (6) 766376 (10) 181139 (62364) 477280 (6) 485952 (6) 647537 (41836) 90107 (7681) 203014 (6) 47515 (11108) 960599 (92748) 224723 (2935) 18139 (79932) 951763 (86265) 935521 (11767) 178884 (10) 342988 (6) 749162 (10) 976781 (59576) 297112 (10) 366719 (5531) 907890 (305) 623147 (55284) 930964 (6) 485814 (6) 139831 (68158) 632903 (75393) 546673 (74771) 590446 (6) 955424 (6) 962238 (19) 448905 (3532) 519029 (18711) 392682 (6) 141195 (42310) 158574 (6) 743242 (10) 564502 (6) 708689 (17637) 312325 (84020) 744137 (91821) 916861 (26927) 639161 (44748) 235254 (6) 335123 (44131) 205260 (6) 732563 (16399) 756104 (10) 984768 (6) 735098 (6) 238579 (87092) 793644 (6) 622949 (55600) 478935 (74491) 654686 (139) 220710 (6) 469506 (6) 88898 (6) 783328 (6) 454507 (89134) 597211 (99230) 372401 (97173) 897818 (6) 969030 (10) 59742 (6) 824715 (74526) 472733 (38932) 240008 (6) 581476 (6) 
     dis: 	0.117 0.132 0.134 0.140 0.141 0.144 0.144 0.145 0.147 0.148 0.149 0.151 0.152 0.153 0.156 0.163 0.172 0.172 0.173 0.174 0.177 0.179 0.181 0.184 0.184 0.190 0.191 0.192 0.192 0.194 0.194 0.195 0.197 0.197 0.199 0.199 0.201 0.202 0.202 0.203 0.205 0.206 0.209 0.214 0.214 0.217 0.219 0.221 0.223 0.223 0.227 0.227 0.230 0.230 0.231 0.235 0.238 0.238 0.240 0.240 0.242 0.242 0.243 0.249 0.256 0.258 0.259 0.262 0.263 0.265 0.266 0.266 0.271 0.272 0.273 0.274 0.276 0.276 0.277 0.278 0.280 0.283 0.284 0.284 0.286 0.291 0.295 0.295 0.296 0.296 0.299 0.301 0.304 0.304 0.305 0.306 0.308 0.309 0.316 0.318 
query 2 nn's (19, 21121, 41068): 610678 (10) 589140 (6) 677414 (6) 400571 (22940) 897152 (6) 925220 (6) 449631 (8327) 665365 (13297) 999566 (10) 551679 (50663) 271621 (16942) 795740 (19) 291604 (6) 150896 (6) 500944 (10) 169619 (56792) 677849 (21496) 540591 (13706) 64217 (95291) 150384 (6) 169974 (19) 438408 (6) 827987 (92013) 366260 (6) 477839 (78835) 812634 (6) 541811 (29013) 555307 (29265) 993325 (3684) 518706 (6) 936082 (6) 974631 (65816) 680478 (6) 966661 (58090) 920205 (74763) 176350 (6) 846488 (6) 989773 (95503) 831052 (19) 401612 (6) 246175 (62356) 730956 (6) 748896 (20) 349224 (10) 853434 (6) 135037 (79200) 570793 (76711) 276586 (10) 999450 (10) 923351 (50859) 373 (13457) 744271 (49754) 719336 (6) 734045 (65977) 490254 (6) 552894 (10) 933042 (6) 74737 (42976) 100569 (20455) 902691 (15269) 156954 (6) 955422 (10) 638287 (86715) 195357 (62630) 449988 (6) 806238 (10) 405315 (26816) 671868 (6) 739249 (76178) 701455 (37575) 813795 (87328) 879455 (51332) 307746 (6) 623916 (6) 951844 (10) 993241 (85796) 470544 (6) 908581 (91950) 300878 (6) 424488 (6) 438569 (29687) 306438 (6) 478928 (10) 333411 (75565) 634346 (6) 473309 (54971) 326224 (10) 723058 (10) 415516 (10) 773513 (80384) 267973 (53591) 772954 (10) 78485 (95012) 448801 (73744) 271515 (54419) 425844 (10) 982071 (45784) 362715 (52305) 540786 (6) 211757 (55990) 
     dis: 	0.284 0.287 0.324 0.341 0.346 0.349 0.351 0.356 0.358 0.360 0.361 0.361 0.361 0.363 0.366 0.368 0.369 0.369 0.370 0.372 0.373 0.378 0.379 0.380 0.380 0.382 0.382 0.383 0.383 0.384 0.386 0.386 0.387 0.387 0.389 0.392 0.395 0.397 0.399 0.401 0.401 0.402 0.402 0.402 0.405 0.407 0.408 0.408 0.408 0.410 0.411 0.411 0.412 0.413 0.414 0.414 0.414 0.414 0.416 0.416 0.417 0.417 0.417 0.418 0.419 0.419 0.421 0.422 0.422 0.422 0.422 0.423 0.423 0.423 0.424 0.424 0.425 0.425 0.426 0.427 0.427 0.427 0.427 0.429 0.429 0.430 0.430 0.431 0.432 0.432 0.433 0.433 0.435 0.435 0.436 0.436 0.437 0.437 0.439 0.440 
query 3 nn's (19, 28857, 48803): 725969 (89970) 528192 (10) 456993 (77323) 860912 (10) 996191 (32188) 329971 (81945) 82793 (71717) 729567 (44365) 170396 (10) 64584 (10) 131512 (10) 587971 (13537) 324678 (6) 942924 (6) 632483 (97262) 219038 (6) 783340 (10) 655203 (88594) 473423 (64444) 421460 (6) 115113 (90311) 191897 (34000) 491797 (43877) 709850 (10) 304409 (69808) 285420 (6) 495900 (6) 401284 (10) 356081 (34599) 159601 (74338) 822974 (10) 806472 (10) 159743 (75219) 975416 (10) 443580 (6) 334814 (6) 663161 (61476) 167103 (46770) 436033 (72443) 842764 (10) 18988 (6) 138002 (10) 159863 (11) 214631 (40968) 349380 (6) 362815 (71039) 731476 (6) 639547 (30060) 190201 (38811) 30952 (6) 861718 (6) 980075 (27743) 873905 (10939) 677310 (6) 242882 (6) 467331 (82540) 419012 (6) 890410 (10) 565509 (21630) 715321 (42515) 192709 (75741) 171268 (6) 224119 (45358) 108845 (30888) 735329 (410) 847878 (6) 2047 (59863) 261148 (6) 416015 (63663) 96524 (6) 685473 (68963) 522298 (6) 615737 (56837) 512134 (10) 88499 (25260) 579174 (10) 707338 (6) 471628 (6) 21558 (6) 357136 (19) 238718 (6) 704458 (6) 991061 (21185) 143504 (6) 193817 (48580) 612218 (6) 921849 (22446) 339518 (6) 776664 (6) 595560 (10) 406549 (86734) 100306 (10) 276137 (62624) 331135 (24630) 79673 (18747) 41618 (6) 807109 (4112) 871814 (6) 172669 (68491) 184553 (8429) 
     dis: 	0.527 0.574 0.581 0.590 0.593 0.594 0.603 0.606 0.617 0.619 0.627 0.631 0.632 0.633 0.637 0.639 0.649 0.650 0.662 0.670 0.671 0.678 0.682 0.685 0.686 0.688 0.689 0.693 0.694 0.698 0.700 0.700 0.702 0.704 0.705 0.707 0.707 0.708 0.708 0.709 0.710 0.716 0.721 0.722 0.725 0.726 0.727 0.730 0.733 0.733 0.734 0.735 0.736 0.737 0.740 0.742 0.742 0.743 0.743 0.745 0.745 0.746 0.746 0.746 0.748 0.749 0.749 0.750 0.750 0.751 0.752 0.752 0.754 0.754 0.758 0.758 0.759 0.759 0.759 0.759 0.760 0.761 0.761 0.761 0.762 0.762 0.764 0.764 0.765 0.766 0.767 0.767 0.767 0.768 0.768 0.768 0.769 0.770 0.771 0.771 
query 4 nn's (19, 67584, 87612): 143565 (49212) 98599 (5092) 517879 (2309) 151023 (41123) 102916 (6) 838409 (80116) 96096 (6) 660107 (67257) 496003 (8720) 224737 (96064) 571456 (20) 439281 (94595) 948975 (66085) 971258 (6) 707476 (10) 383413 (61129) 742646 (10) 212198 (6) 889078 (6) 944271 (21507) 815000 (6) 162683 (22290) 540345 (33471) 837537 (61007) 832624 (10) 942014 (6) 301308 (20) 630156 (10) 969765 (24716) 636401 (42693) 626466 (10) 348814 (10) 25088 (6) 567838 (6) 68477 (98193) 967261 (67448) 176033 (22097) 77687 (68787) 784052 (6) 519031 (51987) 893451 (96288) 718259 (27444) 780299 (5824) 268314 (6) 410294 (6) 578117 (45106) 126533 (3115) 863367 (4395) 125685 (11620) 833671 (29886) 464785 (43590) 762004 (6) 689807 (4987) 917205 (90746) 458569 (48621) 859115 (60573) 624797 (9323) 244443 (73209) 683425 (82851) 92426 (6) 338068 (6) 12627 (27740) 379715 (26339) 300320 (10) 752338 (6) 667479 (56292) 344417 (60635) 889388 (6) 691391 (82971) 867096 (6) 120302 (6) 817941 (21399) 211549 (19958) 98757 (5246) 782790 (10) 976885 (63238) 179728 (10) 765633 (69015) 455735 (6756) 523176 (6) 171465 (67091) 709016 (6) 418428 (6) 33085 (87922) 334903 (75874) 904183 (78795) 226172 (6) 49607 (96850) 649941 (7915) 2463 (39328) 531956 (6) 143402 (6) 176462 (10) 240371 (95552) 584625 (48630) 689858 (6) 762057 (74971) 189802 (10) 977020 (10) 241987 (29820) 
     dis: 	0.331 0.344 0.370 0.376 0.378 0.393 0.396 0.397 0.424 0.426 0.432 0.439 0.440 0.443 0.443 0.443 0.444 0.447 0.448 0.450 0.455 0.457 0.458 0.460 0.463 0.469 0.469 0.469 0.472 0.476 0.479 0.480 0.481 0.482 0.482 0.482 0.482 0.483 0.484 0.485 0.485 0.486 0.486 0.487 0.489 0.490 0.490 0.491 0.491 0.493 0.494 0.494 0.495 0.495 0.497 0.501 0.501 0.501 0.502 0.502 0.503 0.503 0.505 0.505 0.505 0.506 0.507 0.507 0.508 0.509 0.510 0.511 0.511 0.513 0.513 0.516 0.516 0.517 0.518 0.519 0.519 0.520 0.521 0.521 0.522 0.522 0.524 0.524 0.524 0.524 0.525 0.526 0.526 0.526 0.528 0.528 0.529 0.529 0.530 0.530 
[ 323.078s ] *** Query time: 305.423
qps: 32.741
 *** ivfpq recall 
ivfpq get 974877 postive res from 1000000 results, recall@100:0.975
recall dist(10% per bucket): 0.000 0.000 0.000 0.000 0.000 0.000 0.002 0.009 0.047 0.607 0.335 
finished ivfpq index examples
[ 323.123s ] -----DONE-----
	Command being timed: "../faiss/build/demos/ivfpq_query_arbi redcaps1m 1000000 100 1 /mnt/data/mocheng/dataset/redcaps1m/image_embeddings.fvecs /mnt/data/mocheng/dataset/redcaps1m/query.fvecs /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/attr_sel_2_100000_random.json /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/qrangesel_19_2_100000_random_19.json /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/sif_gt_sel_19_2_100000_random_19_100.json /mnt/data/mocheng/dataset/redcaps1m/ivfpq/index/index_ivfpq_sel_2_100000_random_512 400 512"
	User time (seconds): 319.78
	System time (seconds): 3.45
	Percent of CPU this job got: 99%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 5:23.25
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 2625448
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 1227056
	Voluntary context switches: 2
	Involuntary context switches: 537
	Swaps: 0
	File system inputs: 0
	File system outputs: 32
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
Start time: 04:00
====================
START: running TEST_IVFPQ, sift data --

dataset: redcaps1m
N: 1000000
topk: 100
threads: 1
dataset file: /mnt/data/mocheng/dataset/redcaps1m/image_embeddings.fvecs
query file: /mnt/data/mocheng/dataset/redcaps1m/query.fvecs
attr file: /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
qrange file: /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/qrangesel_20_2_100000_random_20.json
gt file: /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/sif_gt_sel_20_2_100000_random_20_100.json
index file: /mnt/data/mocheng/dataset/redcaps1m/ivfpq/index/index_ivfpq_sel_2_100000_random_512
nprobe: 400
dim: 512
loaded base attributes from:/mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/attr_sel_2_100000_random.json
[ 0.133s ] Loaded metadata, 2000000 attr's found
[ 0.133s ] Loading query vectors and attributes
query vecs data loaded, with dim: 512, nb=10000
[ 0.144s ] Loaded query vectors from /mnt/data/mocheng/dataset/redcaps1m/query.fvecs
[ 0.146s ] Loaded 10000 redcaps1m queries
[ 0.212s ] Loaded ground truth, gt_size: 100
[ 0.212s ] Index Params -- d: 512, N: 1000000
 load index size: 1000000
--Index created
==============================================
====================Search Results====================
==============================================
==============================================
====================Search====================
==============================================
==================== IVFPQ INDEX ====================
[ 2.825s ] Searching the 100 nearest neighbors of 10000 vectors in the index
selectivity: 0.001
[ 307.675s ] Query results (vector ids, then distances):
query 0 nn's (20, 62584, 65755): 160390 (6) 599323 (85937) 936239 (3210) 342532 (10) 694741 (84944) 36422 (6) 250705 (60744) 330621 (59140) 569914 (447) 683930 (6) 565844 (6) 355902 (19) 784722 (20) 6047 (83307) 203646 (10) 166039 (57004) 789 (35731) 745076 (6) 244970 (10) 579245 (30560) 752472 (6) 271792 (19) 58142 (6) 744530 (6) 651120 (10) 303148 (6) 490156 (10) 545804 (10) 482585 (47519) 860584 (6) 681982 (10) 823486 (6) 186328 (6) 551474 (10) 215597 (92811) 956032 (10) 481946 (6) 226908 (10) 449194 (6) 867619 (27161) 851066 (6) 204905 (10906) 99389 (42228) 786686 (10) 22693 (76613) 344109 (40605) 82251 (49545) 905321 (27703) 932942 (6) 523634 (6) 707292 (6) 722350 (6) 432847 (88565) 395870 (6) 645156 (6) 763327 (3770) 860976 (6) 108005 (24693) 495326 (10) 778732 (10) 595736 (6) 802959 (6581) 839233 (18430) 793643 (12761) 581515 (94799) 187815 (85629) 814737 (93546) 538957 (15233) 473546 (232) 654812 (6) 477089 (61037) 618507 (82613) 404307 (5225) 976900 (10) 851421 (54103) 32478 (10) 779381 (28898) 955555 (25515) 159425 (60505) 805041 (44083) 759540 (6) 45422 (6) 353747 (27130) 387804 (10) 299606 (6) 597427 (47553) 586125 (56932) 372922 (6) 611047 (1083) 808101 (36415) 32192 (6) 674309 (9719) 632646 (6) 144764 (6) 405394 (10) 639562 (6) 768056 (6) 568061 (94954) 614067 (41100) -1 (0) 
     dis: 	0.999 1.013 1.020 1.020 1.023 1.032 1.046 1.047 1.057 1.066 1.071 1.080 1.082 1.087 1.087 1.088 1.091 1.093 1.096 1.097 1.108 1.112 1.112 1.117 1.118 1.119 1.120 1.121 1.122 1.123 1.124 1.125 1.128 1.128 1.129 1.129 1.130 1.132 1.134 1.136 1.137 1.137 1.139 1.141 1.149 1.155 1.159 1.160 1.163 1.166 1.170 1.170 1.172 1.173 1.173 1.177 1.178 1.179 1.180 1.181 1.183 1.186 1.194 1.201 1.209 1.210 1.213 1.214 1.219 1.223 1.224 1.225 1.226 1.228 1.231 1.233 1.233 1.233 1.234 1.235 1.244 1.255 1.260 1.270 1.271 1.275 1.278 1.286 1.307 1.308 1.319 1.325 1.327 1.329 1.336 1.342 1.346 1.465 1.472 340282346638528859811704183484516925440.000 
query 1 nn's (20, 33359, 36530): 47436 (6) 855537 (76169) 849599 (4379) 690014 (19) 845155 (44800) 379711 (78033) 458546 (6) 443187 (73344) 310879 (61359) 247027 (37826) 318349 (39536) 830632 (6) 36362 (6) 491662 (6) 437709 (92288) 830929 (28175) 301473 (2689) 547561 (84913) 705131 (31724) 63028 (6) 955291 (12977) 934017 (45353) 785524 (10) 171931 (16046) 789914 (6) 58577 (96538) 300965 (67315) 919171 (84232) 226523 (7490) 384594 (20) 296634 (6) 482065 (98378) 788854 (10) 681220 (6) 455379 (57516) 512551 (85065) 914613 (61990) 875363 (46796) 735685 (47091) 414060 (6) 334588 (6) 341661 (56679) 750987 (73713) 65618 (10) 228285 (68461) 809904 (6) 435862 (10) 701379 (17446) 903403 (59255) 202427 (24743) 271645 (51544) 823901 (61440) 180666 (6) 260776 (10) 999610 (6) 278534 (6) 373551 (6866) 671081 (41552) 434696 (6) 361578 (6) 34878 (6) 31553 (1333) 270982 (10) 620228 (6) 717487 (75523) 207309 (17323) 425742 (6) 259480 (10) 923343 (89552) 580733 (93157) 193668 (10) 171886 (6) 838601 (76010) 138971 (89982) 586909 (66122) 14882 (10) 203896 (10) 741234 (20) 379567 (51846) 158516 (6) 556317 (23585) 410864 (6) 548484 (6) 764220 (6) 302941 (87806) 453797 (23239) 864549 (45036) 984609 (79285) 908272 (10) 227193 (80456) 487430 (10) 723483 (42657) 427842 (6) 383634 (19) 761008 (10) 564126 (6) 356619 (40342) 568069 (82198) 132658 (10) 30032 (6) 
     dis: 	0.164 0.205 0.235 0.286 0.306 0.323 0.340 0.347 0.358 0.381 0.396 0.410 0.416 0.443 0.448 0.448 0.463 0.464 0.465 0.485 0.504 0.531 0.538 0.538 0.551 0.555 0.559 0.566 0.566 0.570 0.572 0.576 0.578 0.582 0.584 0.585 0.588 0.595 0.596 0.598 0.602 0.603 0.612 0.615 0.632 0.632 0.632 0.636 0.636 0.638 0.648 0.648 0.648 0.649 0.651 0.652 0.654 0.655 0.656 0.659 0.664 0.666 0.666 0.667 0.667 0.669 0.671 0.671 0.672 0.673 0.675 0.675 0.675 0.676 0.677 0.683 0.684 0.684 0.686 0.687 0.689 0.691 0.693 0.693 0.699 0.711 0.715 0.724 0.727 0.732 0.736 0.741 0.743 0.746 0.748 0.750 0.752 0.756 0.766 0.778 
query 2 nn's (20, 65022, 68166): 290984 (19) 450764 (20) 119482 (10) 35487 (64046) 97834 (10) 251841 (26391) 967691 (15492) 374073 (99421) 682890 (6) 455911 (42086) 707139 (39754) 564980 (6) 111062 (10) 158758 (10) 531635 (74018) 338149 (96767) 508908 (10) 356458 (6) 858090 (6) 785638 (6) 259444 (6) 69444 (6) 33521 (66655) 105147 (83848) 330732 (6) 917847 (57148) 121716 (10) 2686 (10) 875424 (6) 895784 (10) 94975 (87246) 228168 (10) 403708 (10) 137110 (10) 22780 (6) 222904 (6) 614821 (24174) 921637 (50826) 443953 (36044) 507962 (6) 449174 (20) 484621 (29665) 201155 (39935) 581848 (10) 14988 (6) 262544 (10) 649991 (16208) 948681 (92449) 632073 (42874) 55634 (10) 603811 (54909) 606702 (6) 700810 (10) 500650 (6) 668698 (6) 268453 (13088) 513895 (75753) 10400 (10) 405148 (6) 32570 (10) 557533 (50153) 923913 (6312) 783962 (10) 436201 (25513) 326867 (38368) 834744 (10) 355474 (10) 615890 (6) 843559 (51463) 6205 (30549) 653592 (20) 859999 (6782) 693617 (93832) 713685 (20565) 454812 (10) 894801 (91055) 302518 (6) 398948 (6) 554107 (49731) 844031 (83134) 88726 (10) 142277 (39208) 143675 (40493) 210761 (69414) 421680 (6) 665452 (6) 868480 (10) 267426 (6) 663976 (6) 466377 (29925) 114503 (80157) 254077 (37772) 512087 (34455) 387703 (19473) 269012 (6) 48931 (33140) 546358 (10) 263708 (10) 149694 (6) 745156 (6) 
     dis: 	0.314 0.349 0.367 0.375 0.384 0.385 0.385 0.391 0.394 0.399 0.404 0.409 0.419 0.420 0.424 0.435 0.446 0.452 0.453 0.458 0.458 0.462 0.470 0.471 0.475 0.477 0.484 0.486 0.487 0.488 0.493 0.495 0.495 0.498 0.499 0.501 0.504 0.507 0.509 0.511 0.512 0.513 0.514 0.515 0.517 0.517 0.518 0.518 0.519 0.520 0.523 0.526 0.528 0.529 0.532 0.534 0.534 0.536 0.537 0.538 0.539 0.544 0.546 0.547 0.551 0.551 0.554 0.557 0.557 0.560 0.561 0.563 0.564 0.565 0.567 0.569 0.571 0.575 0.577 0.578 0.580 0.583 0.584 0.587 0.589 0.595 0.597 0.598 0.599 0.608 0.608 0.614 0.615 0.616 0.616 0.616 0.616 0.623 0.624 0.625 
query 3 nn's (20, 77495, 80696): 385406 (10) 574303 (35127) 615829 (83162) 137689 (70082) 868263 (17320) 888873 (8339) 534088 (6) 990364 (6) 370501 (87900) 38395 (82376) 896 (6) 940040 (6) 616637 (32520) 437428 (10) 775050 (6) 198273 (37840) 108257 (33024) 61594 (6) 684193 (24443) 100858 (6) 292550 (6) 533271 (48770) 665488 (6) 552691 (32491) 222769 (55788) 58315 (67018) 160009 (43947) 499281 (49260) 740123 (93948) 657620 (6) 906617 (16325) 155086 (10) 364506 (20) 680806 (6) 118060 (6) 993720 (10) 54302 (6) 44659 (42077) 403742 (6) 715529 (92680) 414711 (50702) 445552 (6) 917400 (6) 97598 (6) 674861 (19105) 578730 (6) 514326 (6) 807472 (6) 324809 (48183) 463421 (63182) 216464 (6) 872220 (19) 349035 (41933) 146939 (53546) 320138 (6) 629864 (10) 721130 (6) 722402 (10) 376035 (42011) 864999 (55225) 617747 (77641) 341987 (33679) 924309 (13990) 774494 (10) 716119 (44959) 760325 (53556) 751698 (10) 457761 (76290) 897405 (53780) 332949 (88092) 525013 (67074) 221415 (39386) 192783 (18290) 737416 (10) 607948 (6) 542783 (61183) 994144 (10) 369136 (20) 496548 (6) 460610 (10) 844267 (61469) 232286 (10) 547299 (32498) 301909 (7558) 306917 (12116) 132206 (10) 358566 (10) 977806 (10) 590637 (74741) 526264 (10) 231365 (41391) 693720 (19) 625867 (39507) 82613 (72560) 311901 (25853) 212192 (6) 607838 (10) 877015 (59482) 918776 (10) 486673 (2448) 
     dis: 	0.617 0.627 0.657 0.719 0.734 0.742 0.743 0.744 0.748 0.751 0.757 0.765 0.766 0.770 0.777 0.782 0.783 0.783 0.794 0.797 0.808 0.816 0.824 0.829 0.832 0.834 0.835 0.836 0.843 0.847 0.849 0.852 0.854 0.855 0.860 0.861 0.863 0.863 0.864 0.868 0.873 0.882 0.883 0.885 0.886 0.886 0.888 0.889 0.894 0.895 0.900 0.908 0.910 0.911 0.918 0.921 0.921 0.922 0.922 0.924 0.930 0.931 0.937 0.943 0.945 0.949 0.954 0.965 0.974 0.984 0.987 0.988 0.989 0.993 1.001 1.002 1.003 1.003 1.011 1.012 1.016 1.018 1.020 1.021 1.023 1.025 1.035 1.037 1.038 1.040 1.050 1.051 1.061 1.061 1.066 1.074 1.086 1.092 1.099 1.099 
query 4 nn's (20, 53915, 57058): 561735 (60870) 210342 (428) 333272 (6) 283898 (6) 444339 (19879) 198779 (63298) 427111 (26140) 400844 (6) 640147 (71174) 285965 (81252) 560561 (31041) 791234 (10) 688028 (6) 35756 (6) 791328 (10) 462440 (6) 372977 (40167) 784908 (6) 224566 (19) 220366 (6) 386605 (63823) 179465 (59932) 642821 (96273) 834149 (76895) 442918 (10) 348029 (80042) 881574 (6) 14090 (19) 757496 (6) 312068 (10) 238114 (6) 91880 (10) 485352 (6) 545645 (27530) 268630 (6) 301703 (65218) 260315 (75876) 11681 (62140) 990429 (53611) 765649 (74714) 745173 (56159) 457252 (6) 591420 (10) 526839 (51233) 50828 (6) 682394 (6) 966852 (6) 674107 (29210) 462059 (22214) 929258 (20) 355351 (59689) 66353 (80323) 736664 (6) 634686 (6) 108564 (6) 768166 (10) 280701 (29645) 936081 (14902) 169283 (63602) 89102 (6) 115243 (14679) 779112 (6) 124418 (19) 51172 (10) 48580 (6) 324203 (2199) 686285 (23417) 88689 (97514) 302793 (82771) 238171 (29712) 236402 (6) 63814 (19) 553587 (75347) 389145 (90114) 72998 (6) 708937 (68237) 167822 (10) 856145 (81815) 806353 (15171) 356665 (77436) 641320 (6) 268332 (10) 645738 (19) 437556 (10) 930328 (6) 424779 (98754) 669282 (10) 570204 (10) 450132 (6) 412183 (49507) 212469 (21958) 788635 (86452) 527082 (10) 356617 (53961) 658822 (6) 838826 (6) 361238 (10) 631871 (72884) 468801 (12438) 218165 (64927) 
     dis: 	0.411 0.417 0.442 0.455 0.475 0.481 0.483 0.495 0.497 0.519 0.521 0.522 0.534 0.546 0.559 0.561 0.563 0.564 0.564 0.566 0.569 0.571 0.571 0.573 0.577 0.578 0.579 0.585 0.596 0.601 0.601 0.601 0.602 0.603 0.604 0.605 0.610 0.611 0.612 0.613 0.613 0.616 0.622 0.622 0.624 0.624 0.624 0.624 0.628 0.635 0.637 0.637 0.637 0.641 0.641 0.642 0.643 0.645 0.646 0.647 0.648 0.650 0.651 0.655 0.655 0.657 0.657 0.664 0.666 0.666 0.668 0.669 0.671 0.673 0.678 0.678 0.678 0.678 0.678 0.680 0.681 0.682 0.685 0.697 0.697 0.700 0.703 0.703 0.706 0.708 0.718 0.722 0.726 0.730 0.733 0.742 0.747 0.750 0.751 0.756 
[ 307.675s ] *** Query time: 292.832
qps: 34.149
 *** ivfpq recall 
ivfpq get 704586 postive res from 1000000 results, recall@100:0.705
recall dist(10% per bucket): 0.000 0.000 0.002 0.015 0.079 0.168 0.190 0.210 0.249 0.089 0.000 
finished ivfpq index examples
[ 307.706s ] -----DONE-----
	Command being timed: "../faiss/build/demos/ivfpq_query_arbi redcaps1m 1000000 100 1 /mnt/data/mocheng/dataset/redcaps1m/image_embeddings.fvecs /mnt/data/mocheng/dataset/redcaps1m/query.fvecs /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/attr_sel_2_100000_random.json /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/qrangesel_20_2_100000_random_20.json /mnt/data/mocheng/dataset/redcaps1m/label/sel_2_100000_random/sif_gt_sel_20_2_100000_random_20_100.json /mnt/data/mocheng/dataset/redcaps1m/ivfpq/index/index_ivfpq_sel_2_100000_random_512 400 512"
	User time (seconds): 306.47
	System time (seconds): 1.31
	Percent of CPU this job got: 99%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 5:07.80
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 2626472
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 656351
	Voluntary context switches: 1
	Involuntary context switches: 381
	Swaps: 0
	File system inputs: 0
	File system outputs: 40
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
