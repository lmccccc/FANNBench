Start time: 05:00
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json
query range file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json
partition size M: 4
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
load index from  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random
rii get  18152  postive res from  100000  results, recall@ 10 : 0.18152
recall dist(10\% per bucket):  [1.665e-01 2.918e-01 2.684e-01 1.579e-01 7.720e-02 2.790e-02 8.200e-03
 1.700e-03 2.000e-04 1.000e-04 1.000e-04]
qps:  685.7298612434478
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json 4 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random query"
	User time (seconds): 40.84
	System time (seconds): 5.99
	Percent of CPU this job got: 166%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 0:28.10
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1054012
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 95902
	Voluntary context switches: 257
	Involuntary context switches: 604
	Swaps: 0
	File system inputs: 0
	File system outputs: 8
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json
query range file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json
partition size M: 4
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 4, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 4
Training the subspace: 1 / 4
Training the subspace: 2 / 4
Training the subspace: 3 / 4
SIMD support: avx512
Encoding the subspace: 0 / 4
Encoding the subspace: 1 / 4
Encoding the subspace: 2 / 4
Encoding the subspace: 3 / 4
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 37882
find_nn_time,41
Caution. No codes are assigned to 565-th centers.
Caution. No codes are assigned to 729-th centers.
Caution. No codes are assigned to 794-th centers.
Caution. No codes are assigned to 905-th centers.
Caution. No codes are assigned to 981-th centers.
find_nn+update_center_time,48
Iteration start: 1 / 5
find_nn finished. Error: 35371.7
find_nn_time,17
Caution. No codes are assigned to 565-th centers.
Caution. No codes are assigned to 729-th centers.
Caution. No codes are assigned to 794-th centers.
Caution. No codes are assigned to 905-th centers.
Caution. No codes are assigned to 981-th centers.
find_nn+update_center_time,24
Iteration start: 2 / 5
find_nn finished. Error: 35048.8
find_nn_time,17
Caution. No codes are assigned to 565-th centers.
Caution. No codes are assigned to 729-th centers.
Caution. No codes are assigned to 794-th centers.
Caution. No codes are assigned to 905-th centers.
Caution. No codes are assigned to 981-th centers.
find_nn+update_center_time,24
Iteration start: 3 / 5
find_nn finished. Error: 34954.5
find_nn_time,16
Caution. No codes are assigned to 565-th centers.
Caution. No codes are assigned to 729-th centers.
Caution. No codes are assigned to 794-th centers.
Caution. No codes are assigned to 905-th centers.
Caution. No codes are assigned to 981-th centers.
find_nn+update_center_time,23
Iteration start: 4 / 5
find_nn finished. Error: 34924.2
find_nn_time,16
find_nn+update_center_time,16
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [128, 128, 128, 128, 128]
polyfit coeff: [-6.11495661e-18  1.28000000e+02]
resultant func:  
-6.115e-18 x + 128
train time:  11.611339807510376  add time:  3.848369598388672  construction time:  15.459709405899048
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json 4 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random construction"
	User time (seconds): 206.46
	System time (seconds): 690.15
	Percent of CPU this job got: 5333%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 0:16.81
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1887792
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 70
	Minor (reclaiming a frame) page faults: 5007701
	Voluntary context switches: 2926
	Involuntary context switches: 3567
	Swaps: 0
	File system inputs: 5632
	File system outputs: 26064
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json
query range file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json
partition size M: 4
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
load index from  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random
rii get  18152  postive res from  100000  results, recall@ 10 : 0.18152
recall dist(10\% per bucket):  [1.665e-01 2.918e-01 2.684e-01 1.579e-01 7.720e-02 2.790e-02 8.200e-03
 1.700e-03 2.000e-04 1.000e-04 1.000e-04]
qps:  684.5263076103869
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json 4 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random query"
	User time (seconds): 40.85
	System time (seconds): 5.91
	Percent of CPU this job got: 166%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 0:28.11
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1054456
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 97687
	Voluntary context switches: 302
	Involuntary context switches: 710
	Swaps: 0
	File system inputs: 0
	File system outputs: 24
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json
query range file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json
partition size M: 4
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
load index from  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random
rii get  9270  postive res from  100000  results, recall@ 10 : 0.0927
recall dist(10\% per bucket):  [4.372e-01 3.249e-01 1.524e-01 5.690e-02 2.020e-02 5.500e-03 2.100e-03
 7.000e-04 1.000e-04 0.000e+00 0.000e+00]
qps:  1135.8061078488615
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json 4 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random query"
	User time (seconds): 31.29
	System time (seconds): 6.25
	Percent of CPU this job got: 165%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 0:22.65
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1054104
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 90627
	Voluntary context switches: 298
	Involuntary context switches: 1635
	Swaps: 0
	File system inputs: 0
	File system outputs: 16
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json
query range file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json
partition size M: 4
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
load index from  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random
rii get  18152  postive res from  100000  results, recall@ 10 : 0.18152
recall dist(10\% per bucket):  [1.665e-01 2.918e-01 2.684e-01 1.579e-01 7.720e-02 2.790e-02 8.200e-03
 1.700e-03 2.000e-04 1.000e-04 1.000e-04]
qps:  691.9985897714744
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json 4 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_4_sel_1_8_random query"
	User time (seconds): 36.87
	System time (seconds): 6.22
	Percent of CPU this job got: 154%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 0:27.93
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1056004
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 97200
	Voluntary context switches: 274
	Involuntary context switches: 1504
	Swaps: 0
	File system inputs: 0
	File system outputs: 24
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json
query range file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json
partition size M: 32
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_32_sel_1_8_random
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 32, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 32
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 32
Training the subspace: 2 / 32
Training the subspace: 3 / 32
Training the subspace: 4 / 32
Training the subspace: 5 / 32
Training the subspace: 6 / 32
Training the subspace: 7 / 32
Training the subspace: 8 / 32
Training the subspace: 9 / 32
Training the subspace: 10 / 32
Training the subspace: 11 / 32
Training the subspace: 12 / 32
Training the subspace: 13 / 32
Training the subspace: 14 / 32
Training the subspace: 15 / 32
Training the subspace: 16 / 32
Training the subspace: 17 / 32
Training the subspace: 18 / 32
Training the subspace: 19 / 32
Training the subspace: 20 / 32
Training the subspace: 21 / 32
Training the subspace: 22 / 32
Training the subspace: 23 / 32
Training the subspace: 24 / 32
Training the subspace: 25 / 32
Training the subspace: 26 / 32
Training the subspace: 27 / 32
Training the subspace: 28 / 32
Training the subspace: 29 / 32
Training the subspace: 30 / 32
Training the subspace: 31 / 32
SIMD support: avx512
Encoding the subspace: 0 / 32
Encoding the subspace: 1 / 32
Encoding the subspace: 2 / 32
Encoding the subspace: 3 / 32
Encoding the subspace: 4 / 32
Encoding the subspace: 5 / 32
Encoding the subspace: 6 / 32
Encoding the subspace: 7 / 32
Encoding the subspace: 8 / 32
Encoding the subspace: 9 / 32
Encoding the subspace: 10 / 32
Encoding the subspace: 11 / 32
Encoding the subspace: 12 / 32
Encoding the subspace: 13 / 32
Encoding the subspace: 14 / 32
Encoding the subspace: 15 / 32
Encoding the subspace: 16 / 32
Encoding the subspace: 17 / 32
Encoding the subspace: 18 / 32
Encoding the subspace: 19 / 32
Encoding the subspace: 20 / 32
Encoding the subspace: 21 / 32
Encoding the subspace: 22 / 32
Encoding the subspace: 23 / 32
Encoding the subspace: 24 / 32
Encoding the subspace: 25 / 32
Encoding the subspace: 26 / 32
Encoding the subspace: 27 / 32
Encoding the subspace: 28 / 32
Encoding the subspace: 29 / 32
Encoding the subspace: 30 / 32
Encoding the subspace: 31 / 32
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 74103.8
find_nn_time,137
find_nn+update_center_time,303
Iteration start: 1 / 5
find_nn finished. Error: 55027.4
find_nn_time,111
find_nn+update_center_time,280
Iteration start: 2 / 5
find_nn finished. Error: 53797.5
find_nn_time,110
find_nn+update_center_time,283
Iteration start: 3 / 5
find_nn finished. Error: 53316.5
find_nn_time,107
find_nn+update_center_time,274
Iteration start: 4 / 5
find_nn finished. Error: 53058.2
find_nn_time,114
find_nn+update_center_time,114
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [256, 128, 128, 16384, 128]
polyfit coeff: [1.92172043e-01 2.21333333e+03]
resultant func:  
0.1922 x + 2213
train time:  49.301491498947144  add time:  48.413233041763306  construction time:  97.71472454071045
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_32_sel_1_8_random
construction done
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json 32 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_32_sel_1_8_random construction"
	User time (seconds): 1262.89
	System time (seconds): 7.67
	Percent of CPU this job got: 1281%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 1:39.17
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1056008
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 211509
	Voluntary context switches: 63394
	Involuntary context switches: 155599
	Swaps: 0
	File system inputs: 64
	File system outputs: 135840
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json
query range file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json
partition size M: 32
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_32_sel_1_8_random
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
load index from  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_32_sel_1_8_random
rii get  61632  postive res from  100000  results, recall@ 10 : 0.61632
recall dist(10\% per bucket):  [0.0008 0.0066 0.0236 0.0494 0.0987 0.1598 0.2041 0.2122 0.1572 0.0762
 0.0114]
qps:  597.4279868714389
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json 32 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_32_sel_1_8_random query"
	User time (seconds): 41.08
	System time (seconds): 6.40
	Percent of CPU this job got: 146%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 0:32.42
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1054528
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 293854
	Voluntary context switches: 243
	Involuntary context switches: 1637
	Swaps: 0
	File system inputs: 0
	File system outputs: 24
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
N: 1000000
dataset file: /mnt/data/mocheng/dataset/sift/sift_base.fvecs
query file: /mnt/data/mocheng/dataset/sift/sift_query.fvecs
train file: /mnt/data/mocheng/dataset/sift/sift_learn.fvecs
attr file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json
query range file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json
ground truth file: /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json
partition size M: 64
K: 10
index file location: /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_8_random
get dataset size: 1000000  d: 128
get query szie: 10000
get train szie: 100000
_N: 1000000  N: 1000000
get range dim: 2.0
groundtruth top K:  10.0
ngt= 100000  nq= 10000  k= 10
M: 64, Ks: 256, metric : <class 'numpy.uint8'>, code_dtype: l2
iter: 20, seed: 123
Training the subspace: 0 / 64
/home/mocheng/anaconda3/envs/py38/lib/python3.8/site-packages/scipy/cluster/vq.py:602: UserWarning: One of the clusters is empty. Re-run kmeans with a different initialization.
  warnings.warn("One of the clusters is empty. "
Training the subspace: 1 / 64
Training the subspace: 2 / 64
Training the subspace: 3 / 64
Training the subspace: 4 / 64
Training the subspace: 5 / 64
Training the subspace: 6 / 64
Training the subspace: 7 / 64
Training the subspace: 8 / 64
Training the subspace: 9 / 64
Training the subspace: 10 / 64
Training the subspace: 11 / 64
Training the subspace: 12 / 64
Training the subspace: 13 / 64
Training the subspace: 14 / 64
Training the subspace: 15 / 64
Training the subspace: 16 / 64
Training the subspace: 17 / 64
Training the subspace: 18 / 64
Training the subspace: 19 / 64
Training the subspace: 20 / 64
Training the subspace: 21 / 64
Training the subspace: 22 / 64
Training the subspace: 23 / 64
Training the subspace: 24 / 64
Training the subspace: 25 / 64
Training the subspace: 26 / 64
Training the subspace: 27 / 64
Training the subspace: 28 / 64
Training the subspace: 29 / 64
Training the subspace: 30 / 64
Training the subspace: 31 / 64
Training the subspace: 32 / 64
Training the subspace: 33 / 64
Training the subspace: 34 / 64
Training the subspace: 35 / 64
Training the subspace: 36 / 64
Training the subspace: 37 / 64
Training the subspace: 38 / 64
Training the subspace: 39 / 64
Training the subspace: 40 / 64
Training the subspace: 41 / 64
Training the subspace: 42 / 64
Training the subspace: 43 / 64
Training the subspace: 44 / 64
Training the subspace: 45 / 64
Training the subspace: 46 / 64
Training the subspace: 47 / 64
Training the subspace: 48 / 64
Training the subspace: 49 / 64
Training the subspace: 50 / 64
Training the subspace: 51 / 64
Training the subspace: 52 / 64
Training the subspace: 53 / 64
Training the subspace: 54 / 64
Training the subspace: 55 / 64
Training the subspace: 56 / 64
Training the subspace: 57 / 64
Training the subspace: 58 / 64
Training the subspace: 59 / 64
Training the subspace: 60 / 64
Training the subspace: 61 / 64
Training the subspace: 62 / 64
Training the subspace: 63 / 64
SIMD support: avx512
Encoding the subspace: 0 / 64
Encoding the subspace: 1 / 64
Encoding the subspace: 2 / 64
Encoding the subspace: 3 / 64
Encoding the subspace: 4 / 64
Encoding the subspace: 5 / 64
Encoding the subspace: 6 / 64
Encoding the subspace: 7 / 64
Encoding the subspace: 8 / 64
Encoding the subspace: 9 / 64
Encoding the subspace: 10 / 64
Encoding the subspace: 11 / 64
Encoding the subspace: 12 / 64
Encoding the subspace: 13 / 64
Encoding the subspace: 14 / 64
Encoding the subspace: 15 / 64
Encoding the subspace: 16 / 64
Encoding the subspace: 17 / 64
Encoding the subspace: 18 / 64
Encoding the subspace: 19 / 64
Encoding the subspace: 20 / 64
Encoding the subspace: 21 / 64
Encoding the subspace: 22 / 64
Encoding the subspace: 23 / 64
Encoding the subspace: 24 / 64
Encoding the subspace: 25 / 64
Encoding the subspace: 26 / 64
Encoding the subspace: 27 / 64
Encoding the subspace: 28 / 64
Encoding the subspace: 29 / 64
Encoding the subspace: 30 / 64
Encoding the subspace: 31 / 64
Encoding the subspace: 32 / 64
Encoding the subspace: 33 / 64
Encoding the subspace: 34 / 64
Encoding the subspace: 35 / 64
Encoding the subspace: 36 / 64
Encoding the subspace: 37 / 64
Encoding the subspace: 38 / 64
Encoding the subspace: 39 / 64
Encoding the subspace: 40 / 64
Encoding the subspace: 41 / 64
Encoding the subspace: 42 / 64
Encoding the subspace: 43 / 64
Encoding the subspace: 44 / 64
Encoding the subspace: 45 / 64
Encoding the subspace: 46 / 64
Encoding the subspace: 47 / 64
Encoding the subspace: 48 / 64
Encoding the subspace: 49 / 64
Encoding the subspace: 50 / 64
Encoding the subspace: 51 / 64
Encoding the subspace: 52 / 64
Encoding the subspace: 53 / 64
Encoding the subspace: 54 / 64
Encoding the subspace: 55 / 64
Encoding the subspace: 56 / 64
Encoding the subspace: 57 / 64
Encoding the subspace: 58 / 64
Encoding the subspace: 59 / 64
Encoding the subspace: 60 / 64
Encoding the subspace: 61 / 64
Encoding the subspace: 62 / 64
Encoding the subspace: 63 / 64
1000000 new vectors are added.
Total number of codes is 1000000
The number of vectors used for training of coarse centers: 100000
Start to run PQk-means
Iteration start: 0 / 5
find_nn finished. Error: 75027.1
find_nn_time,217
find_nn+update_center_time,433
Iteration start: 1 / 5
find_nn finished. Error: 53432.2
find_nn_time,211
find_nn+update_center_time,442
Iteration start: 2 / 5
find_nn finished. Error: 52012.8
find_nn_time,212
find_nn+update_center_time,440
Iteration start: 3 / 5
find_nn finished. Error: 51435.5
find_nn_time,211
find_nn+update_center_time,446
Iteration start: 4 / 5
find_nn finished. Error: 51126.6
find_nn_time,211
find_nn+update_center_time,211
Start to update posting lists
===== Threshold selection ====
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
ivf is faster than linear scan even if |S|<=128. This is a bit weird. Anyway let's set threshold as 128
L: [1000, 2000, 4000, 8000, 16000]
threshold: [512, 128, 128, 128, 33792]
polyfit coeff: [ 2.20369892e+00 -6.72533333e+03]
resultant func:  
2.204 x - 6725
train time:  59.353856325149536  add time:  51.57749700546265  construction time:  110.93135333061218
index save to  /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_8_random
rii get  70243  postive res from  100000  results, recall@ 10 : 0.70243
recall dist(10\% per bucket):  [0.0005 0.0044 0.0138 0.0299 0.0609 0.0945 0.1454 0.1851 0.2232 0.1902
 0.0521]
qps:  503.984892988235
	Command being timed: "python -u utils/test_rii.py 1000000 /mnt/data/mocheng/dataset/sift/sift_base.fvecs /mnt/data/mocheng/dataset/sift/sift_query.fvecs /mnt/data/mocheng/dataset/sift/sift_learn.fvecs /mnt/data/mocheng/dataset/sift/sel_1_8_random/attr_sel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/qrangesel_1_8_random.json /mnt/data/mocheng/dataset/sift/sel_1_8_random/sif_gt_10.json 64 10 /mnt/data/mocheng/dataset/sift/rii/index/index_rii_64_sel_1_8_random query"
	User time (seconds): 1500.21
	System time (seconds): 7.32
	Percent of CPU this job got: 1039%
	Elapsed (wall clock) time (h:mm:ss or m:ss): 2:25.09
	Average shared text size (kbytes): 0
	Average unshared data size (kbytes): 0
	Average stack size (kbytes): 0
	Average total size (kbytes): 0
	Maximum resident set size (kbytes): 1300432
	Average resident set size (kbytes): 0
	Major (requiring I/O) page faults: 0
	Minor (reclaiming a frame) page faults: 372478
	Voluntary context switches: 22670
	Involuntary context switches: 47437
	Swaps: 0
	File system inputs: 0
	File system outputs: 261200
	Socket messages sent: 0
	Socket messages received: 0
	Signals delivered: 0
	Page size (bytes): 4096
	Exit status: 0
